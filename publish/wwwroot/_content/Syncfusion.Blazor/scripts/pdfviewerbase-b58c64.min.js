(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{"./bundles/pdfviewerbase.js":function(e,t,i){"use strict";i.r(t);var n=i("../node_modules/@babel/runtime/helpers/typeof.js"),r=i.n(n);window.sf=window.sf||{};sfBlazor.modules.pdfviewerbase="pdfviewer.Drawing",window.sf.pdfviewer=window.sf.base.extend({},window.sf.pdfviewer,function(e){var t,i,n=(t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,i)},function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}),o=function(e,t,i,n){var o,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===("undefined"==typeof Reflect?"undefined":r()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var d=e.length-1;d>=0;d--)(o=e[d])&&(a=(s<3?o(a):s>3?o(t,i,a):o(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a},s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),o([sf.base.Property(0)],t.prototype,"x",void 0),o([sf.base.Property(0)],t.prototype,"y",void 0),o([sf.base.Property(0)],t.prototype,"width",void 0),o([sf.base.Property(0)],t.prototype,"height",void 0),o([sf.base.Property(0)],t.prototype,"left",void 0),o([sf.base.Property(0)],t.prototype,"top",void 0),o([sf.base.Property(0)],t.prototype,"right",void 0),o([sf.base.Property(0)],t.prototype,"bottom",void 0),o([sf.base.Complex({x:0,y:0},sf.drawings.Point)],t.prototype,"location",void 0),o([sf.base.Complex(new sf.drawings.Size(0,0),sf.drawings.Size)],t.prototype,"size",void 0),t}(sf.base.ChildProperty),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),o([sf.base.Property(!1)],t.prototype,"isBold",void 0),o([sf.base.Property(!1)],t.prototype,"isItalic",void 0),o([sf.base.Property(!1)],t.prototype,"isUnderline",void 0),o([sf.base.Property(!1)],t.prototype,"isStrikeout",void 0),t}(sf.base.ChildProperty),d=function(e){function t(t,i,n,r){return e.call(this,t,i,n,r)||this}return n(t,e),o([sf.base.Property("")],t.prototype,"id",void 0),o([sf.base.Property("Rectangle")],t.prototype,"shapeAnnotationType",void 0),o([sf.base.Property("")],t.prototype,"measureType",void 0),o([sf.base.Property("")],t.prototype,"author",void 0),o([sf.base.Property("")],t.prototype,"modifiedDate",void 0),o([sf.base.Property("")],t.prototype,"subject",void 0),o([sf.base.Property("")],t.prototype,"notes",void 0),o([sf.base.Property("black")],t.prototype,"strokeColor",void 0),o([sf.base.Property("#ffffff00")],t.prototype,"fillColor",void 0),o([sf.base.Property("#ffffff00")],t.prototype,"stampFillColor",void 0),o([sf.base.Property("black")],t.prototype,"stampStrokeColor",void 0),o([sf.base.Property("")],t.prototype,"data",void 0),o([sf.base.Property(1)],t.prototype,"opacity",void 0),o([sf.base.Property(1)],t.prototype,"thickness",void 0),o([sf.base.Property("")],t.prototype,"borderStyle",void 0),o([sf.base.Property("")],t.prototype,"borderDashArray",void 0),o([sf.base.Property(0)],t.prototype,"rotateAngle",void 0),o([sf.base.Property(!1)],t.prototype,"isCloudShape",void 0),o([sf.base.Property(0)],t.prototype,"cloudIntensity",void 0),o([sf.base.Property(40)],t.prototype,"leaderHeight",void 0),o([sf.base.Property(null)],t.prototype,"lineHeadStart",void 0),o([sf.base.Property(null)],t.prototype,"lineHeadEnd",void 0),o([sf.base.Property([])],t.prototype,"vertexPoints",void 0),o([sf.base.Property(null)],t.prototype,"sourcePoint",void 0),o([sf.base.Property("None")],t.prototype,"sourceDecoraterShapes",void 0),o([sf.base.Property("None")],t.prototype,"taregetDecoraterShapes",void 0),o([sf.base.Property(null)],t.prototype,"targetPoint",void 0),o([sf.base.Property([])],t.prototype,"segments",void 0),o([sf.base.Complex({x:0,y:0},s)],t.prototype,"bounds",void 0),o([sf.base.Property(0)],t.prototype,"pageIndex",void 0),o([sf.base.Property(-1)],t.prototype,"zIndex",void 0),o([sf.base.Property(null)],t.prototype,"wrapper",void 0),o([sf.base.Property(!1)],t.prototype,"isDynamicStamp",void 0),o([sf.base.Property("")],t.prototype,"dynamicText",void 0),o([sf.base.Property("")],t.prototype,"annotName",void 0),o([sf.base.Property({})],t.prototype,"review",void 0),o([sf.base.Property([])],t.prototype,"comments",void 0),o([sf.base.Property("#000")],t.prototype,"fontColor",void 0),o([sf.base.Property(16)],t.prototype,"fontSize",void 0),o([sf.base.Property("Helvetica")],t.prototype,"fontFamily",void 0),o([sf.base.Property(!1)],t.prototype,"enableShapeLabel",void 0),o([sf.base.Property("label")],t.prototype,"labelContent",void 0),o([sf.base.Property("#ffffff00")],t.prototype,"labelFillColor",void 0),o([sf.base.Property(15)],t.prototype,"labelMaxLength",void 0),o([sf.base.Property(1)],t.prototype,"labelOpacity",void 0),o([sf.base.Property("")],t.prototype,"annotationSelectorSettings",void 0),o([sf.base.Property("#ffffff00")],t.prototype,"labelBorderColor",void 0),o([sf.base.Property("left")],t.prototype,"textAlign",void 0),o([sf.base.Property("")],t.prototype,"signatureName",void 0),o([sf.base.Property(0)],t.prototype,"minHeight",void 0),o([sf.base.Property(0)],t.prototype,"minWidth",void 0),o([sf.base.Property(0)],t.prototype,"maxHeight",void 0),o([sf.base.Property(0)],t.prototype,"maxWidth",void 0),o([sf.base.Property(!1)],t.prototype,"isLock",void 0),o([sf.base.Property("UI Drawn Annotation")],t.prototype,"annotationAddMode",void 0),o([sf.base.Property("")],t.prototype,"annotationSettings",void 0),o([sf.base.Property(16)],t.prototype,"previousFontSize",void 0),o([sf.base.Complex({isBold:!1,isItalic:!1,isStrikeout:!1,isUnderline:!1},a)],t.prototype,"font",void 0),o([sf.base.Complex({x:0,y:0},s)],t.prototype,"labelBounds",void 0),o([sf.base.Property(null)],t.prototype,"customData",void 0),t}(sf.base.ChildProperty),l=function(){function e(){this.pageIdTemp=0,this.zIndexTemp=-1,this.childNodesTemp=[],this.objects=[],this.zIndexTemp=-1,this.pageIdTemp=0}return Object.defineProperty(e.prototype,"pageId",{get:function(){return this.pageIdTemp},set:function(e){this.pageIdTemp=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this.zIndexTemp},set:function(e){this.zIndexTemp=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objects",{get:function(){return this.childNodesTemp},set:function(e){this.childNodesTemp=e},enumerable:!0,configurable:!0}),e}(),h=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),c=function(e,t,i,n){var o,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===("undefined"==typeof Reflect?"undefined":r()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var d=e.length-1;d>=0;d--)(o=e[d])&&(a=(s<3?o(a):s>3?o(t,i,a):o(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a},p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return h(t,e),t.prototype.init=function(e){var t=new sf.drawings.Container;t.measureChildren=!1;new sf.drawings.Size;if(t.children=[],this.annotations)for(var i=0;i<this.annotations.length;i++){var n=e.pdfViewer.nameTable[this.annotations[i].id].wrapper;t.children.push(n)}return this.wrapper=t,t},c([sf.base.Property(null)],t.prototype,"wrapper",void 0),c([sf.base.Collection([],d)],t.prototype,"annotations",void 0),c([sf.base.Property()],t.prototype,"width",void 0),c([sf.base.Property()],t.prototype,"height",void 0),c([sf.base.Property(0)],t.prototype,"rotateAngle",void 0),c([sf.base.Property(0)],t.prototype,"offsetX",void 0),c([sf.base.Property(0)],t.prototype,"offsetY",void 0),c([sf.base.Complex({x:.5,y:.5},sf.drawings.Point)],t.prototype,"pivot",void 0),t}(sf.base.ChildProperty);function f(e){return"Line"===e.shapeAnnotationType||"LineWidthArrowHead"===e.shapeAnnotationType||"Distance"===e.shapeAnnotationType||"Polygon"===e.shapeAnnotationType}function g(e,t){if(e&&t){var i="#ffffff00"===e.fillColor?"transparent":e.fillColor;t.style.fill=i,t.style.strokeColor=e.strokeColor,t.style.color=e.strokeColor,t.style.strokeWidth=e.thickness,t.style.strokeDashArray=e.borderDashArray,t.style.opacity=e.opacity}}function S(e){for(var t=0,i=0;i<e.length-1;i++)t+=sf.drawings.Point.findLength(e[i],e[i+1]);return t}function u(e,t){var i={width:e.actualSize.width,height:e.actualSize.height,x:e.offsetX-e.actualSize.width*e.pivot.x+.5,y:e.offsetY-e.actualSize.height*e.pivot.y+.5,angle:e.rotateAngle+e.parentTransform,fill:e.style.fill,stroke:e.style.strokeColor,pivotX:e.pivot.x,pivotY:e.pivot.y,strokeWidth:1,opacity:e.style.opacity,dashArray:e.style.strokeDashArray||"",visible:e.visible,id:e.id};return t&&(i.x+=t.tx,i.y+=t.ty),i}function w(e){return void 0!==e&&"string"==typeof e&&(e=sf.base.getValue(e,window)),e}function m(e,t,i){var n={},r="properties";if(e){i=e.propName;var o=e[r]||e,s=[],a=[];if((s=s.concat(Object.keys(o))).push("version"),i){var d=w(t);a=d?d(i):[],s=s.concat(a)}for(var l=v(i),h=0,c=s=s.concat(l);h<c.length;h++){var p=c[h];if("historyManager"!==p)if("wrapper"!==p)!(!e[p]||!e.hasOwnProperty("observers"))||(e[p]instanceof Array?n[p]=y(-1===l.indexOf(p)&&e[r]?e[r][p]:e[p],t,p):e[p]instanceof Array==!1&&e[p]instanceof HTMLElement?n[p]=e[p].cloneNode(!0).innerHtml:e[p]instanceof Array==!1&&e[p]instanceof Object?n[p]=m(-1===l.indexOf(p)&&e[r]?e[r][p]:e[p]):n[p]=e[p]);else e[p]&&(n[p]={actualSize:{width:e[p].actualSize.width,height:e[p].actualSize.height},offsetX:e[p].offsetX,offsetY:e[p].offsetY})}}return n}function y(e,t,i){var n;if(e){n=[];for(var r=0;r<e.length;r++)e[r]instanceof Array?n.push(e[r]):e[r]instanceof Object?n.push(m(e[r],t,i)):n.push(e[r])}return n}function v(e){switch(e){case"nodes":case"children":return["inEdges","outEdges","parentId","processId","nodeId","umlIndex","isPhase","isLane"];case"connectors":return["parentId"];case"annotation":case"annotations":return["nodeId"];case"shape":return["hasHeader"]}return[]}function b(e,t){var i;if("Distance"===e.shapeAnnotationType)for(var n=0,r=void 0,o=0;o<e.wrapper.children.length;o++){var s=sf.drawings.Point.findAngle(e.sourcePoint,e.targetPoint);if(e.wrapper.children[o].id.indexOf("leader")>-1){var a=e.wrapper.children[0].bounds.center;if(0===n){r={x:e.sourcePoint.x,y:e.sourcePoint.y-e.leaderHeight};e.sourcePoint}else r={x:e.targetPoint.x,y:e.targetPoint.y-e.leaderHeight},a=e.targetPoint;var d=sf.drawings.identityMatrix();if(sf.drawings.rotateMatrix(d,s,a.x,a.y),i=sf.drawings.transformPointByMatrix(d,{x:r.x,y:r.y}),t==="Leader"+n)return{leader:"leader"+n,point:i};n++}}return{leader:"",point:i}}function x(e,t){Math.abs(e.sourcePoint.x-e.targetPoint.x),Math.abs(e.sourcePoint.y-e.targetPoint.y);var i=e.vertexPoints.slice(0);return i&&i.length>0&&(e.sourcePoint=i[0],e.targetPoint=i[i.length-1]),i}function P(e,t){for(var i,n="",r=[],o=0;o<t.length;)r.push({x:t[o].x,y:t[o].y}),o++;r=O(e,r);for(var s=0;s<r.length;s++)i=r[s],0===s&&(n="M"+i.x+" "+i.y),s>0&&(n+=" L"+i.x+" "+i.y);return n}function z(e,t,i){var n,r=new sf.drawings.Rect;return n=P(e,t),r=sf.drawings.Rect.toBounds(t),i.width=r.width,i.height=r.height,i.offsetX=r.x+i.width/2,i.offsetY=r.y+i.height/2,i.data=n,e.wrapper&&(e.wrapper.offsetX=i.offsetX,e.wrapper.offsetY=i.offsetY,e.wrapper.width=r.width,e.wrapper.height=r.height),i}function V(e,t){var i;return i=x(e),t.staticSize=!0,g(e,t=z(e,i,t)),t}function A(e,t,i,n,r){var o,s;t.offsetX=i.x,t.offsetY=i.y,s=sf.drawings.Point.findAngle(i,n);var a=e.thickness<=5?5:e.thickness;o=j(r?e.sourceDecoraterShapes:e.taregetDecoraterShapes);var d=new sf.drawings.Size(2*a,2*a);t.transform=sf.drawings.RotateTransform.Self,g(e,t),t.style.fill="tranparent"!==e.fillColor?e.fillColor:"white",t.rotateAngle=s,t.data=o,t.canMeasurePath=!0,t.width=d.width,t.height=d.height}function C(e,t,i,n){var r=new sf.drawings.PathElement;return A(e,r,t,i,n),r}function O(e,t){return t[0]=T(e,t,!0),t[t.length-1]=T(e,t,!1),t}function T(e,t,i){var n,r,o={x:0,y:0},s=t.length;n=i?t[0]:t[s-1],r=i?t[1]:t[s-2];var a=sf.drawings.Point.distancePoints(n,r);a=0===a?1:a;var d=e.thickness;o.x=Math.round(n.x+d*(r.x-n.x)/a),o.y=Math.round(n.y+d*(r.y-n.y)/a);return o=sf.drawings.Point.adjustPoint(o,r,!0,.5)}function H(e,t,i,n){var r,o=[],s=sf.drawings.Point.findAngle(t[0],t[1]);return r=D(e,s),!n.enableImportAnnotationMeasurement&&e.notes&&""!==e.notes?r.content=e.notes:r.content=i.setConversion(S([t[0],t[1]])*i.pixelToPointFactor,e),r.rotateValue={y:-10,angle:s},!0===e.enableShapeLabel&&(r.style.strokeColor=e.labelBorderColor,r.style.fill=e.labelFillColor,r.style.fontSize=e.fontSize,r.style.color=e.fontColor,r.style.fontFamily=e.fontFamily),o.push(r),o}function B(e,t,i,n){var r,o=[],s=sf.drawings.Point.findAngle(t[0],t[1]);return r=D(e,s),!n.enableImportAnnotationMeasurement&&e.notes&&""!==e.notes?r.content=e.notes:r.content=i.calculatePerimeter(e),!0===e.enableShapeLabel&&(r.style.strokeColor=e.labelBorderColor,r.style.fill=e.labelFillColor,r.style.fontSize=e.fontSize,r.style.color=e.fontColor,r.style.fontFamily=e.fontFamily),r.rotateValue={y:-10,angle:s},o.push(r),o}function k(e,t,i){for(var n,r=0;r<e.wrapper.children.length;r++){var o=e.wrapper.children[r];o&&!sf.base.isNullOrUndefined(o.content)&&(n=i.calculatePerimeter(e),o.content=n,o.childNodes[0].text=o.content,o.refreshTextElement())}return n}function N(e){var t,i,n="";for(n="M"+e[0].x+" "+e[0].y,i=1;i<e.length;i++)n+="L"+(t=e[i]).x+" "+t.y;return n+="Z"}function D(e,t){var i=new sf.drawings.TextElement;return g(e,i),i.style.fill="transparent",i.id=sf.drawings.randomId(),i.horizontalAlignment="Center",i.rotateValue={y:10,angle:t},i.verticalAlignment="Top",i.relativeMode="Object",i.setOffsetWithRespectToBounds(.5,.5,"Absolute"),i.rotateAngle=t,i.style.textWrapping="NoWrap",i}function M(e,t){var i=[],n=L(e,t[0],t[1]);return i.push(n),n=L(e,t[1],t[0],!0),i.push(n),i}function L(e,t,i,n){var r=new sf.drawings.PathElement;r.offsetX=t.x,r.offsetY=t.y;var o,s=sf.drawings.Point.findAngle(t,i),a={x:(t.x+i.x)/2,y:(t.y+i.y)/2},d=sf.drawings.identityMatrix();sf.drawings.rotateMatrix(d,0-s,a.x,a.y);var l=sf.drawings.transformPointByMatrix(d,t),h={x:l.x,y:l.y-e.leaderHeight};d=sf.drawings.identityMatrix(),sf.drawings.rotateMatrix(d,s,r.offsetX,r.offsetY),l=sf.drawings.transformPointByMatrix(d,h);var c={x:t.x,y:t.y};r.offsetX=c.x,r.offsetY=c.y,r.transform=sf.drawings.RotateTransform.Self,o="M"+t.x+","+t.y+",L"+l.x+","+l.y+"Z";var p=new sf.drawings.Size(0,e.leaderHeight);return r.pivot.x=.5,n?(r.id="leader2_"+sf.drawings.randomId(),r.pivot.y=0):(r.id="leader1_"+sf.drawings.randomId(),r.pivot.y=1),g(e,r),r.rotateAngle=s,r.data=o,r.canMeasurePath=!0,r.width=p.width,r.height=p.height,r}function F(e,t){for(var i=e.vertexPoints,n=0;n<i.length-1;n++){var r=i[n],o=i[n+1],s=sf.drawings.Rect.toBounds([r,o]);if(s.Inflate(10),s.containsPoint(t)){var a=I(t,r,o),d={x1:r.x,x2:o.x,y1:r.y,y2:o.y},l={x1:t.x,x2:a.x,y1:t.y,y2:a.y},h=sf.drawings.intersect3(d,l);if(h.enabled){var c=sf.drawings.Point.findLength(t,h.intersectPt);if(Math.abs(c)<10)return!0}else{var p=sf.drawings.Rect.toBounds([t,t]);if(p.Inflate(3),p.containsPoint(r)||p.containsPoint(o))return!0}if(sf.drawings.Point.equals(t,a))return!0}}return!1}function I(e,t,i){var n;n=sf.drawings.Point.findLength(t,e)>sf.drawings.Point.findLength(i,e)?i:t;var r=sf.drawings.Point.findAngle(t,i),o=sf.drawings.Point.findAngle(n,e),s=sf.drawings.Point.findLength(n,e),a=o+2*(r-o);return{x:n.x+s*Math.cos(a*Math.PI/180),y:n.y+s*Math.sin(a*Math.PI/180)}}function j(e){return U[e]}var E,U={OpenArrow:"M15.9,23 L5,16 L15.9,9 L17,10.7 L8.7,16 L17,21.3Z",Square:"M0,0 L10,0 L10,10 L0,10 z",Fletch:"M14.8,10c0,0-3.5,6,0.2,12c0,0-2.5-6-10.9-6C4.1,16,11.3,16,14.8,10z",OpenFetch:"M6,17c-0.6,0-1-0.4-1-1s0.4-1,1-1c10.9,0,11-5,11-5c0-0.6,0.4-1,1-1s1,0.4,1,1C19,10.3,18.9,17,6,17C6,17,6,17,6,17z M18,23c-0.5,0-1-0.4-1-1c0-0.2-0.3-5-11-5c-0.6,0-1-0.5-1-1s0.4-1,1-1c0,0,0,0,0,0c12.9,0,13,6.7,13,7    C19,22.6,18.6,23,18,23z",IndentedArrow:"M17,10c0,0-4.5,5.5,0,12L5,16L17,10z",OutdentedArrow:"M14.6,10c0,0,5.4,6,0,12L5,16L14.6,10z",DoubleArrow:"M19,10 L19,22 L13,16Z M12,10 L12,22 L6,16Z",Arrow:"M15,10 L15,22 L5,16Z",Diamond:"M12,23l-7-7l7-7l6.9,7L12,23z",Circle:"M0,50 A50,50,0 1 1 100,50 A50,50,0 1 1 0,50 Z"},R=function(){function e(e){this.isDynamicStamps=!1,this.pdfViewer=e,this.renderer=new sf.drawings.DrawingRenderer("this.pdfViewer.element.id",!1),this.svgRenderer=new sf.drawings.SvgRenderer}return e.prototype.renderLabels=function(e){var t=e.annotations;if(t)for(var i=0;i<t.length;i++){var n=t[i];this.initObject(n)}},e.prototype.createNewZindexTable=function(e){var t=new l;return this.pdfViewer.zIndex++,t.pageId=this.pdfViewer.zIndex,this.pdfViewer.zIndexTable.push(t),t},e.prototype.getPageTable=function(e){var t;if(void 0!==this.pdfViewer.zIndexTable.length){for(var i=!0,n=0;n<this.pdfViewer.zIndexTable.length;n++)if(this.pdfViewer.zIndexTable[n].pageId===e){i=!1,t=this.pdfViewer.zIndexTable[n];break}i&&((t=this.createNewZindexTable(e)).pageId=e)}else t=this.createNewZindexTable(e);return t},e.prototype.setZIndex=function(e,t){if(void 0!==t.pageIndex){var i=this.getPageTable(t.pageIndex);if(-1===t.zIndex)i.zIndex++,t.zIndex=i.zIndex,i.objects.push(t);else{t.zIndex;var n=i.objects.length;t.zIndex=n++,i.objects.push(t)}}},e.prototype.initObject=function(e){return this.setZIndex(this.pdfViewer.zIndex,e),sf.drawings.createMeasureElements(),f(e)?(this.initLine(e),e.wrapper.measure(new sf.drawings.Size(void 0,void 0)),e.wrapper.arrange(e.wrapper.desiredSize)):this.initNode(e),e.wrapper,this.pdfViewer.nameTable[e.id]=e,e},e.prototype.initNode=function(e){var t,i=this.initContainer(e);i.children||(i.children=[]),t||(t=this.init(e,i)),i.rotateAngle=e.rotateAngle,i.measure(new sf.drawings.Size(e.wrapper.width,e.wrapper.height)),i.arrange(i.desiredSize),this.isDynamicStamps&&(this.pdfViewer.annotation.stampAnnotationModule.updateSessionStorage(e,null,"dynamicStamp"),this.isDynamicStamps=!1)},e.prototype.init=function(e,t){var i,n,r;i=new sf.drawings.DrawingElement;var o=!1,s=this.pdfViewer.annotationModule.findAnnotationSettings(e),a=0,d=0,l=0,h=0;(s.minWidth||s.maxWidth||s.minHeight||s.maxHeight)&&(a=s.maxHeight?s.maxHeight:2e3,d=s.maxWidth?s.maxWidth:2e3,l=s.minHeight?s.minHeight:0,h=s.minWidth?s.minWidth:0);var c=!1;switch((l||h||a||d)&&(c=!0),e.shapeAnnotationType){case"Ellipse":if((n=new sf.drawings.PathElement).data="M80.5,12.5 C80.5,19.127417 62.59139,24.5 40.5,24.5 C18.40861,24.5 0.5,19.127417 0.5,12.5C0.5,5.872583 18.40861,0.5 40.5,0.5 C62.59139,0.5 80.5,5.872583 80.5,12.5 z",i=n,t.children.push(i),e.enableShapeLabel)(m=this.textElement(e)).content=e.labelContent,m.style.color=e.fontColor,m.style.strokeColor=e.labelBorderColor,m.style.fill=e.labelFillColor,m.style.fontSize=e.fontSize,m.style.fontFamily=e.fontFamily,m.style.opacity=e.labelOpacity,t.children.push(m);break;case"Path":(n=new sf.drawings.PathElement).data=e.data,i=n,t.children.push(i);break;case"HandWrittenSignature":case"Ink":(n=new sf.drawings.PathElement).data=e.data,n.style.strokeColor=e.strokeColor,n.style.strokeWidth=e.thickness,n.style.opacity=e.opacity,i=n,t.children.push(i);break;case"Polygon":(n=new sf.drawings.PathElement).data=N(e.vertexPoints),i=n,t.children.push(i);break;case"Stamp":if(o=!0,this.isDynamicStamps=!0,e&&e.annotationAddMode&&"Existing Annotation"===e.annotationAddMode&&(e.bounds.width=e.bounds.width-20,e.bounds.height=e.bounds.height-20),e.isDynamicStamp){t.horizontalAlignment="Left",(i=r=new sf.drawings.DrawingElement).cornerRadius=10,i.style.fill=e.stampFillColor,i.style.strokeColor=e.stampStrokeColor,t.children.push(i);var p=this.textElement(e);(p=new sf.drawings.TextElement).style.fontFamily="Helvetica",p.style.fontSize=14,p.style.italic=!0,p.style.bold=!0,p.style.color=e.fillColor,p.rotateValue=void 0,p.content=e.dynamicText,p.relativeMode="Point",p.margin.left=10,p.margin.bottom=-7,p.setOffsetWithRespectToBounds(0,.57,null),p.relativeMode="Point",t.children.push(p),(u=new sf.drawings.PathElement).id=sf.drawings.randomId()+"_stamp",u.data=e.data,u.width=e.bounds.width,c&&e.bounds.width>d&&(u.width=d,e.bounds.width=d),u.height=e.bounds.height/2,c&&e.bounds.height>a&&(u.height=a/2,e.bounds.height=a/2),u.rotateValue=void 0,u.margin.left=10,u.margin.bottom=-5,u.relativeMode="Point",u.setOffsetWithRespectToBounds(0,.1,null);var f=u;u.style.fill=e.fillColor,u.style.strokeColor=e.strokeColor,u.style.opacity=e.opacity,i.width=e.bounds.width+20,i.height=e.bounds.height+20,i.style.opacity=e.opacity,t.children.push(f)}else{var u;t.horizontalAlignment="Left",(i=r=new sf.drawings.DrawingElement).cornerRadius=10,i.style.fill=e.stampFillColor,i.style.strokeColor=e.stampStrokeColor,t.children.push(i),(u=new sf.drawings.PathElement).id=sf.drawings.randomId()+"_stamp",u.data=e.data,u.width=e.bounds.width,c&&e.bounds.width>d&&(u.width=d,e.bounds.width=d),u.height=e.bounds.height,c&&e.bounds.height>a&&(u.height=a,e.bounds.height=a),u.minWidth=u.width/2,u.minHeight=u.height/2;f=u;u.style.fill=e.fillColor,u.style.strokeColor=e.strokeColor,u.style.opacity=e.opacity,i.width=e.bounds.width+20,i.height=e.bounds.height+20,i.minWidth=u.width/2,i.minHeight=u.height/2,i.style.opacity=e.opacity,t.children.push(f),t.minHeight=i.minHeight+20,t.minWidth=i.minWidth+20}e&&e.annotationAddMode&&"Existing Annotation"===e.annotationAddMode&&(e.bounds.width=e.bounds.width+20,e.bounds.height=e.bounds.height+20);break;case"Image":var w=new sf.drawings.ImageElement;w.source=e.data,i=w,t.children.push(i);break;case"Rectangle":var m;if(i=r=new sf.drawings.DrawingElement,t.children.push(i),e.enableShapeLabel)(m=this.textElement(e)).content=e.labelContent,m.style.color=e.fontColor,m.style.strokeColor=e.labelBorderColor,m.style.fill=e.labelFillColor,m.style.fontSize=e.fontSize,m.style.fontFamily=e.fontFamily,m.style.opacity=e.labelOpacity,t.children.push(m);break;case"Perimeter":(n=new sf.drawings.PathElement).data="M80.5,12.5 C80.5,19.127417 62.59139,24.5 40.5,24.5 C18.40861,24.5 0.5,19.127417 0.5,12.5C0.5,5.872583 18.40861,0.5 40.5,0.5 C62.59139,0.5 80.5,5.872583 80.5,12.5 z",i=n,g(e,n),t.children.push(i),(r=new sf.drawings.DrawingElement).id="perimeter_"+sf.drawings.randomId(),r.height=.2,r.width=.2,r.transform=sf.drawings.RotateTransform.Self,r.horizontalAlignment="Stretch",this.setNodePosition(r,e),r.rotateAngle=e.rotateAngle,g(e,r),t.children.push(r);var y=this.textElement(e);(y=new sf.drawings.TextElement).content=y.content=S([{x:e.bounds.x,y:e.bounds.y},{x:e.bounds.x+e.bounds.width,y:e.bounds.y+e.bounds.height}]).toString(),y.rotateValue={y:-10,angle:e.rotateAngle},t.children.push(y);break;case"Radius":(n=new sf.drawings.PathElement).data="M80.5,12.5 C80.5,19.127417 62.59139,24.5 40.5,24.5 C18.40861,24.5 0.5,19.127417 0.5,12.5C0.5,5.872583 18.40861,0.5 40.5,0.5 C62.59139,0.5 80.5,5.872583 80.5,12.5 z",i=n,g(e,n),t.children.push(i),(r=new sf.drawings.DrawingElement).id="radius_"+sf.drawings.randomId(),r.height=.2,r.width=e.bounds.width/2,r.transform=sf.drawings.RotateTransform.Self,this.setNodePosition(r,e),r.rotateAngle=e.rotateAngle,g(e,r),t.children.push(r),y=this.textElement(e),e.enableShapeLabel&&(y.style.color=e.fontColor,y.style.strokeColor=e.labelBorderColor,y.style.fill=e.labelFillColor,y.style.fontSize=e.fontSize,y.style.fontFamily=e.fontFamily,y.style.opacity=e.labelOpacity);var v=S([{x:e.bounds.x,y:e.bounds.y},{x:e.bounds.x+e.bounds.width,y:e.bounds.y+e.bounds.height}]);!this.pdfViewer.enableImportAnnotationMeasurement&&e.notes&&""!==e.notes?y.content=e.notes:y.content=this.pdfViewer.annotation.measureAnnotationModule.setConversion(v/2*this.pdfViewer.annotation.measureAnnotationModule.pixelToPointFactor,e),y.rotateValue={y:-10,x:e.bounds.width/4,angle:e.rotateAngle},t.children.push(y);break;case"StickyNotes":var b=new sf.drawings.ImageElement;b.source=e.data,b.width=e.bounds.width,b.height=e.bounds.height,b.style.strokeColor=e.strokeColor,b.style.strokeWidth=0,i=b,t.children.push(i);break;case"FreeText":i=new sf.drawings.DrawingElement,t.children.push(i);var x=this.textElement(e);(x=new sf.drawings.TextElement).style.fontFamily=e.fontFamily,x.style.fontSize=e.fontSize,x.style.textAlign="Left","center"===e.textAlign.toLowerCase()?x.style.textAlign="Center":"right"===e.textAlign.toLowerCase()?x.style.textAlign="Right":"justify"===e.textAlign.toLowerCase()&&(x.style.textAlign="Justify"),x.style.color=e.fontColor,x.style.bold=e.font.isBold,x.style.italic=e.font.isItalic,!0===e.font.isUnderline?x.style.textDecoration="Underline":!0===e.font.isStrikeout&&(x.style.textDecoration="LineThrough"),x.rotateValue=void 0,x.content=e.dynamicText,x.margin.left=2,x.margin.top=5,x.style.textWrapping="Wrap",x.relativeMode="Point",x.setOffsetWithRespectToBounds(0,0,null),x.relativeMode="Point",t.children.push(x)}return i.id=e.id+"_content",i.relativeMode="Object",o||(void 0!==e.bounds.width&&(i.width=e.bounds.width,c&&(i.width<h||i.width>d)&&(i.width<h&&(i.width=h),i.width>d&&(i.width=d))),i.horizontalAlignment="Stretch",void 0!==e.bounds.height&&(i.height=e.bounds.height,c&&(i.height<l||i.width>a)&&(i.height<l&&(i.height=l),i.height>a&&(i.height=a))),g(e,i)),i.isRectElement=!0,i.verticalAlignment="Stretch",i},e.prototype.textElement=function(e){var t=new sf.drawings.TextElement;return g(e,t),t.horizontalAlignment="Center",t.verticalAlignment="Top",t.relativeMode="Object",t.setOffsetWithRespectToBounds(.5,.5,"Absolute"),t},e.prototype.setNodePosition=function(e,t){if("Perimeter"===t.shapeAnnotationType)e.offsetX=t.bounds.x+t.bounds.width/2,e.offsetY=t.bounds.y+t.bounds.height/2;else if("Radius"===t.shapeAnnotationType){var i={x:t.bounds.x+t.bounds.width/2+t.bounds.width/4,y:t.bounds.y+t.bounds.height/2},n={x:t.bounds.x+t.bounds.width/2,y:t.bounds.y+t.bounds.height/2},r=sf.drawings.identityMatrix();sf.drawings.rotateMatrix(r,t.rotateAngle,n.x,n.y);var o=sf.drawings.transformPointByMatrix(r,i),s={x:o.x,y:o.y};e.offsetX=s.x,e.offsetY=s.y,e.width=t.bounds.width/2}},e.prototype.initContainer=function(e){var t;return e.id||(e.id=sf.drawings.randomId()),(t=new sf.drawings.Canvas).id=e.id,t.offsetX=e.bounds.x+.5*e.bounds.width,t.offsetY=e.bounds.y+.5*e.bounds.height,t.style.fill="transparent",t.style.strokeColor="transparent",t.rotateAngle=e.rotateAngle,e.wrapper=t,t},e.prototype.initLine=function(e){e.id||(e.id=sf.drawings.randomId());var t=new sf.drawings.Canvas,i=new sf.drawings.PathElement;i.id=e.id+"_path";var n,r=new sf.drawings.PathElement,o=new sf.drawings.PathElement;if(e.vertexPoints.length){e.sourcePoint=e.vertexPoints[0],e.targetPoint=e.vertexPoints[e.vertexPoints.length-1];for(var s=0;s<e.vertexPoints.length;s++)0!==s&&s!==e.vertexPoints.length-1&&e.segments.push(e.vertexPoints[s])}i=V(e,i);var a=[];a=x(e);var d=[],l=[];if("Distance"===e.shapeAnnotationType&&(d=M(e,a),l=H(e,a,this.pdfViewer.annotation.measureAnnotationModule,this.pdfViewer)),"Line"!==e.shapeAnnotationType&&"LineWidthArrowHead"!==e.shapeAnnotationType||"Perimeter"!==e.measureType||(l=B(e,a,this.pdfViewer.annotation.measureAnnotationModule,this.pdfViewer)),!0===e.enableShapeLabel&&"Distance"!==e.shapeAnnotationType&&"Perimeter"!==e.measureType){var h=void 0,c=sf.drawings.Point.findAngle(a[0],a[1]);(h=this.textElement(e)).id=sf.drawings.randomId(),!this.pdfViewer.enableImportAnnotationMeasurement&&e.notes&&""!==e.notes?h.content=e.notes:h.content=e.labelContent,h.style.strokeColor=e.labelBorderColor,h.style.fill=e.labelFillColor,h.style.fontSize=e.fontSize,h.style.color=e.fontColor,h.style.fontFamily=e.fontFamily,h.style.opacity=e.labelOpacity,h.rotateValue={y:-10,angle:c},l.push(h)}a=O(e,a),n=sf.drawings.Rect.toBounds(a),t.width=n.width,t.height=n.height,t.offsetX=n.x+t.pivot.x*n.width,t.offsetY=n.y+t.pivot.y*n.height;var p=e.vertexPoints;if("Line"!==e.shapeAnnotationType&&"LineWidthArrowHead"!==e.shapeAnnotationType&&"Distance"!==e.shapeAnnotationType||(r=C(e,a[0],p[1],!0),o=C(e,a[a.length-1],p[p.length-2],!1)),r.id=e.id+"_srcDec",o.id=e.id+"_tarDec",i.style.fill="transparent",t.style.strokeColor="transparent",t.style.fill="transparent",t.style.strokeWidth=0,t.children=[],g(e,i),t.children.push(i),d.length>0)for(s=0;s<d.length;s++)t.children.push(d[s]);if(l.length>0)for(s=0;s<l.length;s++)t.children.push(l[s]);return t.children.push(r),t.children.push(o),t.id=e.id,t.offsetX=i.offsetX,t.offsetY=i.offsetY,t.width=i.width,t.height=i.height,a=x(e),e.wrapper=t,t},e.prototype.add=function(e){return e=new d(this.pdfViewer,"annotations",e,!0),e=this.initObject(e),this.pdfViewer.annotations.push(e),e},e.prototype.remove=function(e){for(var t=e.pageIndex,i=0;i<this.pdfViewer.annotations.length;i++){var n=this.pdfViewer.annotations[i];if(n.id===e.id||n.wrapper.id===e.id){this.pdfViewer.annotations.splice(i,1);for(var r=this.getPageObjects(e.pageIndex),o=0;o<r.length;o++)r[o].id===e.id&&r.splice(o,1)}}this.pdfViewer.renderDrawing(void 0,t)},e.prototype.getPageObjects=function(e){return this.getPageTable(e).objects},e.prototype.refreshCanvasDiagramLayer=function(e,t){if(e||(e=document.getElementById(this.pdfViewer.element.id+"_annotationCanvas_"+t)),e){var i=e.width/this.pdfViewer.viewerBase.getZoomFactor(),n=e.height/this.pdfViewer.viewerBase.getZoomFactor(),r=this.pdfViewer.viewerBase.getZoomFactor(),o=e.getContext("2d");o.setTransform(r,0,0,r,0,0),o.clearRect(0,0,i,n);for(var s=this.getPageObjects(t),a=0;a<s.length;a++){var d=this.pdfViewer.nameTable[s[a].id].wrapper;sf.drawings.refreshDiagramElements(e,[d],this.renderer)}}},e.prototype.clearHighlighter=function(e){var t=this.getAdornerLayerSvg(this.pdfViewer.element.id+e+"_diagramAdornerLayer",e);if(t){var i=t.getElementById(t.id+"_highlighter");i&&i.parentNode.removeChild(i)}},e.prototype.getSelectorElement=function(e,t){var i=null,n=this.getAdornerLayerSvg(e,t);return n&&(i=n.getElementById(e+"_SelectorElement")),i},e.prototype.getAdornerLayerSvg=function(e,t){var i=null,n=sf.drawings.getDiagramElement(e+t+"_diagramAdornerLayer");return n&&(i=n.getElementsByClassName("e-adorner-layer"+t)[0]),i},e.prototype.clearSelectorLayer=function(e){var t=this.getAdornerLayerSvg(this.pdfViewer.element.id,e);if(t){var i=t.getElementById(this.pdfViewer.adornerSvgLayer.id+"_selected_region");i&&i.parentNode.removeChild(i),this.clearHighlighter(e);for(var n=this.getSelectorElement(this.pdfViewer.element.id,e).childNodes,r=void 0,o=n.length;o>0;o--)(r=n[o-1]).parentNode.removeChild(r)}},e.prototype.renderSelector=function(e,t,i,n){if(!i||n){var r=new sf.drawings.Size,o=this.pdfViewer.selectedItems;if(this.clearSelectorLayer(e),o.wrapper){o.wrapper.measure(r);var s=this.pdfViewer.viewerBase.getZoomFactor();o.wrapper.arrange(o.wrapper.desiredSize),o.width=o.wrapper.actualSize.width,o.height=o.wrapper.actualSize.height,o.offsetX=o.wrapper.offsetX,o.offsetY=o.wrapper.offsetY,1===o.annotations.length&&(o.rotateAngle=o.annotations[0].rotateAngle,o.wrapper.rotateAngle=o.annotations[0].rotateAngle);o.wrapper.bounds;var a=void 0;if(o.annotations.length)for(var d=0;d<o.annotations.length;d++){var l=o.annotations[d];(a=this.getSelectorElement(this.pdfViewer.element.id,e))&&l.pageIndex===e&&("Distance"===l.shapeAnnotationType||"Line"===l.shapeAnnotationType||"LineWidthArrowHead"===l.shapeAnnotationType||"Polygon"===l.shapeAnnotationType?this.renderEndPointHandle(l,a,o.thumbsConstraints,{scale:s,tx:0,ty:0},void 0,void 0,!0,t):"StickyNotes"===l.shapeAnnotationType?this.renderResizeHandle(l.wrapper.children[0],a,o.thumbsConstraints,s,void 0,void 0,void 0,!1,!0,null,null,t):"Stamp"!==this.pdfViewer.tool&&this.renderResizeHandle(l.wrapper.children[0],a,o.thumbsConstraints,s,void 0,void 0,void 0,"Stamp"===l.shapeAnnotationType,!1,"Path"===l.shapeAnnotationType,"FreeText"===l.shapeAnnotationType||"HandWrittenSignature"===l.shapeAnnotationType||"Image"===l.shapeAnnotationType,t),this.pdfViewer.viewerBase.isNewSignatureAdded||"HandWrittenSignature"!==l.shapeAnnotationType||this.pdfViewer.annotationModule.selectSignature(l.signatureName,l.pageIndex,l),""!==l.annotName&&i&&l===i&&(this.pdfViewer.viewerBase.isAnnotationSelect||this.pdfViewer.viewerBase.isAnnotationMouseDown||this.pdfViewer.viewerBase.isAnnotationMouseMove||this.pdfViewer.viewerBase.isInkAdded||(this.pdfViewer.viewerBase.isAnnotationSelect=!0,this.pdfViewer.annotationModule.annotationSelect(l.annotName,l.pageIndex,l))))}}}},e.prototype.rotate=function(e,t,i,n){if(e)if(i=i||{x:e.wrapper.offsetX,y:e.wrapper.offsetY},e instanceof p){e.rotateAngle+=t,e.wrapper.rotateAngle+=t;var r=[];r=r.concat(e.annotations),this.rotateObjects(e,r,t,i,null,n)}else this.rotateObjects(e,[e],t,i)},e.prototype.rotateObjects=function(e,t,i,n,r,o){n=n||{};var s=sf.drawings.identityMatrix();sf.drawings.rotateMatrix(s,i,n.x,n.y);for(var a=0,l=t;a<l.length;a++){var h=l[a];if(h instanceof d){if(!1!==r||e!==h){h.rotateAngle+=i,h.rotateAngle=(h.rotateAngle+360)%360;var c=sf.drawings.transformPointByMatrix(s,{x:h.wrapper.offsetX,y:h.wrapper.offsetY});h.wrapper.offsetX=c.x,h.wrapper.offsetY=c.y,this.nodePropertyChange(h,{rotateAngle:h.rotateAngle})}this.renderSelector(h.pageIndex,o)}}},e.prototype.getParentSvg=function(e,t,i){return e&&e.id&&t&&"selector"===t?this.pdfViewer.adornerSvgLayer:i},e.prototype.renderBorder=function(e,t,i,n,o,s,a,d){var l=u(e,n);if(n=n||{scale:1,tx:0,ty:0},d){l.x*=n.scale,l.y*=n.scale,l.width*=n.scale,l.height*=n.scale;h=void 0;if(h=this.pdfViewer.selectedItems.annotations[0].shapeAnnotationType,i&&"object"!==r()(i)&&""!==i){f=""===(c=JSON.parse(i)).selectionBorderColor?"black":c.selectionBorderColor;l.stroke=f,l.strokeWidth=1===i.selectionBorderThickness?1:c.selectionBorderThickness,(p=0===c.selectorLineDashArray.length?[6,3]:c.selectorLineDashArray).length>2&&(p=[p[0],p[1]]),l.dashArray=p.toString()}else this.getBorderSelector(h,l)}else{l.x*=n.scale,l.y*=n.scale,l.width*=n.scale,l.height*=n.scale,l.fill="transparent";var h=void 0;if(h=this.pdfViewer.selectedItems.annotations[0].shapeAnnotationType,i&&"object"!==r()(i)&&""!==i){var c,p,f=""===(c=JSON.parse(i)).selectionBorderColor?"black":c.selectionBorderColor;l.stroke=f,l.strokeWidth=1===i.selectionBorderThickness?1:c.selectionBorderThickness,(p=0===c.selectorLineDashArray.length?[6,3]:c.selectorLineDashArray).length>2&&(p=[p[0],p[1]]),l.dashArray=p.toString()}else"HandWrittenSignature"===h?this.getSignBorder(h,l):this.getBorderSelector(h,l);l.class="e-pv-diagram-border",a&&(l.class+=" e-diagram-lane"),l.id="borderRect",l.id="borderRect",o||(l.class+=" e-disabled"),s&&(l.class+=" e-thick-border"),l.cornerRadius=0}var g=this.getParentSvg(e,"selector");this.svgRenderer.drawRectangle(t,l,this.pdfViewer.element.id,void 0,!0,g)},e.prototype.getSignBorder=function(e,t){if(this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings){var i=void 0;i=sf.base.isNullOrUndefined(this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.selectionBorderColor)||""===this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.selectionBorderColor?"#0000ff":this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.selectionBorderColor,t.stroke=i;var n;n=sf.base.isNullOrUndefined(this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.selectionBorderThickness)?1:this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.selectionBorderThickness,t.strokeWidth=n;var r=void 0;(r=sf.base.isNullOrUndefined(this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.selectorLineDashArray)||0===this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.selectorLineDashArray.length?[4]:this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.selectorLineDashArray).length>2&&(r=[r[0],r[1]]),t.dashArray=r.toString()}else{var o=this.pdfViewer.annotationSelectorSettings;i=""===o.selectionBorderColor?"black":o.selectionBorderColor;t.stroke=i,t.strokeWidth=1===o.selectionBorderThickness?1:o.selectionBorderThickness,(r=0===o.selectorLineDashArray.length?[6,3]:o.selectorLineDashArray).length>2&&(r=[r[0],r[1]]),t.dashArray=r.toString()}},e.prototype.getBorderSelector=function(e,t){var i=this.pdfViewer.annotationSelectorSettings,n=""===i.selectionBorderColor?"black":i.selectionBorderColor;t.stroke=n,t.strokeWidth=1===i.selectionBorderThickness?1:i.selectionBorderThickness;var r=0===i.selectorLineDashArray.length?[6,3]:i.selectorLineDashArray;if(r.length>2&&(r=[r[0],r[1]]),t.dashArray=r.toString(),"Rectangle"===e&&this.pdfViewer.rectangleSettings.annotationSelectorSettings){var o=sf.base.isNullOrUndefined(this.pdfViewer.rectangleSettings.annotationSelectorSettings.selectionBorderColor)||""===this.pdfViewer.rectangleSettings.annotationSelectorSettings.selectionBorderColor?"black":this.pdfViewer.rectangleSettings.annotationSelectorSettings.selectionBorderColor;t.stroke=o;var s=sf.base.isNullOrUndefined(this.pdfViewer.rectangleSettings.annotationSelectorSettings.selectionBorderThickness)?1:this.pdfViewer.rectangleSettings.annotationSelectorSettings.selectionBorderThickness;t.strokeWidth=s;var a=sf.base.isNullOrUndefined(this.pdfViewer.rectangleSettings.annotationSelectorSettings.selectorLineDashArray)||0===this.pdfViewer.rectangleSettings.annotationSelectorSettings.selectorLineDashArray.length?[4]:this.pdfViewer.rectangleSettings.annotationSelectorSettings.selectorLineDashArray;a.length>2&&(a=[a[0],a[1]]),t.dashArray=a.toString()}else if("Ellipse"===e&&this.pdfViewer.circleSettings.annotationSelectorSettings){var d=sf.base.isNullOrUndefined(this.pdfViewer.circleSettings.annotationSelectorSettings.selectionBorderColor)||""===this.pdfViewer.circleSettings.annotationSelectorSettings.selectionBorderColor?"black":this.pdfViewer.circleSettings.annotationSelectorSettings.selectionBorderColor;t.stroke=d;s=sf.base.isNullOrUndefined(this.pdfViewer.circleSettings.annotationSelectorSettings.selectionBorderThickness)?1:this.pdfViewer.circleSettings.annotationSelectorSettings.selectionBorderThickness;t.strokeWidth=s;var l=sf.base.isNullOrUndefined(this.pdfViewer.circleSettings.annotationSelectorSettings.selectorLineDashArray)||0===this.pdfViewer.circleSettings.annotationSelectorSettings.selectorLineDashArray.length?[4]:this.pdfViewer.circleSettings.annotationSelectorSettings.selectorLineDashArray;l.length>2&&(l=[l[0],l[1]]),t.dashArray=l.toString()}else if("Radius"===e&&this.pdfViewer.radiusSettings.annotationSelectorSettings){var h=sf.base.isNullOrUndefined(this.pdfViewer.radiusSettings.annotationSelectorSettings.selectionBorderColor)||""===this.pdfViewer.radiusSettings.annotationSelectorSettings.selectionBorderColor?"black":this.pdfViewer.radiusSettings.annotationSelectorSettings.selectionBorderColor;t.stroke=h;s=sf.base.isNullOrUndefined(this.pdfViewer.radiusSettings.annotationSelectorSettings.selectionBorderThickness)?1:this.pdfViewer.radiusSettings.annotationSelectorSettings.selectionBorderThickness;t.strokeWidth=s;var c=sf.base.isNullOrUndefined(this.pdfViewer.radiusSettings.annotationSelectorSettings.selectorLineDashArray)||0===this.pdfViewer.radiusSettings.annotationSelectorSettings.selectorLineDashArray.length?[4]:this.pdfViewer.radiusSettings.annotationSelectorSettings.selectorLineDashArray;c.length>2&&(c=[c[0],c[1]]),t.dashArray=c.toString()}else if("FreeText"===e&&this.pdfViewer.freeTextSettings.annotationSelectorSettings){var p=sf.base.isNullOrUndefined(this.pdfViewer.freeTextSettings.annotationSelectorSettings.selectionBorderColor)||""===this.pdfViewer.freeTextSettings.annotationSelectorSettings.selectionBorderColor?"black":this.pdfViewer.freeTextSettings.annotationSelectorSettings.selectionBorderColor;t.stroke=p;s=sf.base.isNullOrUndefined(this.pdfViewer.freeTextSettings.annotationSelectorSettings.selectionBorderThickness)?1:this.pdfViewer.freeTextSettings.annotationSelectorSettings.selectionBorderThickness;t.strokeWidth=s;var f=sf.base.isNullOrUndefined(this.pdfViewer.freeTextSettings.annotationSelectorSettings.selectorLineDashArray)||0===this.pdfViewer.freeTextSettings.annotationSelectorSettings.selectorLineDashArray.length?[4]:this.pdfViewer.freeTextSettings.annotationSelectorSettings.selectorLineDashArray;f.length>2&&(f=[f[0],f[1]]),t.dashArray=f.toString()}else if("StickyNotes"===e&&this.pdfViewer.stickyNotesSettings.annotationSelectorSettings){var g=sf.base.isNullOrUndefined(this.pdfViewer.stickyNotesSettings.annotationSelectorSettings.selectionBorderColor)||""===this.pdfViewer.stickyNotesSettings.annotationSelectorSettings.selectionBorderColor?"black":this.pdfViewer.stickyNotesSettings.annotationSelectorSettings.selectionBorderColor;t.stroke=g;s=sf.base.isNullOrUndefined(this.pdfViewer.stickyNotesSettings.annotationSelectorSettings.selectionBorderThickness)?1:this.pdfViewer.stickyNotesSettings.annotationSelectorSettings.selectionBorderThickness;t.strokeWidth=s;var S=sf.base.isNullOrUndefined(this.pdfViewer.stickyNotesSettings.annotationSelectorSettings.selectorLineDashArray)||0===this.pdfViewer.stickyNotesSettings.annotationSelectorSettings.selectorLineDashArray.length?[6,3]:this.pdfViewer.stickyNotesSettings.annotationSelectorSettings.selectorLineDashArray;S.length>2&&(S=[S[0],S[1]]),t.dashArray=S.toString()}else if("Stamp"===e&&this.pdfViewer.stampSettings.annotationSelectorSettings){var u=sf.base.isNullOrUndefined(this.pdfViewer.stampSettings.annotationSelectorSettings.selectionBorderColor)||""===this.pdfViewer.stampSettings.annotationSelectorSettings.selectionBorderColor?"#0000ff":this.pdfViewer.stampSettings.annotationSelectorSettings.selectionBorderColor;t.stroke=u;s=sf.base.isNullOrUndefined(this.pdfViewer.stampSettings.annotationSelectorSettings.selectionBorderThickness)?1:this.pdfViewer.stampSettings.annotationSelectorSettings.selectionBorderThickness;t.strokeWidth=s;var w=sf.base.isNullOrUndefined(this.pdfViewer.stampSettings.annotationSelectorSettings.selectorLineDashArray)||0===this.pdfViewer.stampSettings.annotationSelectorSettings.selectorLineDashArray.length?[4]:this.pdfViewer.stampSettings.annotationSelectorSettings.selectorLineDashArray;w.length>2&&(w=[w[0],w[1]]),t.dashArray=w.toString()}},e.prototype.renderCircularHandle=function(e,t,i,n,r,o,s,a,d,l,h,c,p,f){var g=t,S={x:i,y:n};if(a=a||{scale:1,tx:0,ty:0},0!==g.rotateAngle||0!==g.parentTransform){var w=sf.drawings.identityMatrix();sf.drawings.rotateMatrix(w,g.rotateAngle+g.parentTransform,g.offsetX,g.offsetY),S=sf.drawings.transformPointByMatrix(w,S)}var m,y=u(g);m=this.pdfViewer.selectedItems.annotations[0].measureType?this.pdfViewer.selectedItems.annotations[0].measureType:this.pdfViewer.selectedItems.annotations[0].shapeAnnotationType,this.getResizerColors(m,y,f,a),this.getShapeSize(m,y,f,a),y.strokeWidth=1,void 0!==c&&(y.id="segmentEnd_"+c),y.centerX=(S.x+a.tx)*a.scale,y.centerY=(S.y+a.ty)*a.scale,y.angle=0,y.id=e,y.visible=o,y.class=p,y.opacity=1,d&&(y.class+=" e-connected"),l&&(y.visible=!1),y.x=S.x*a.scale-y.width/2,y.y=S.y*a.scale-y.height/2;var v=this.getParentSvg(t,"selector");"Square"===this.getShape(m,f)?this.svgRenderer.drawRectangle(r,y,e,void 0,!0,v):"Circle"===this.getShape(m,f)&&this.svgRenderer.drawCircle(r,y,1)},e.prototype.getShapeSize=function(e,t,i,n){if(i&&"object"!==r()(i)&&""!==i){var o=JSON.parse(i);t.radius=(sf.base.isNullOrUndefined(o.resizerSize)||8===o.resizerSize?8:o.resizerSize)/2,t.width=(sf.base.isNullOrUndefined(o.resizerSize)||8===o.resizerSize?8:o.resizerSize)*n.scale,t.height=(sf.base.isNullOrUndefined(o.resizerSize)||8===o.resizerSize?8:o.resizerSize)*n.scale}else{o=this.pdfViewer.annotationSelectorSettings;t.radius=(sf.base.isNullOrUndefined(o.resizerSize)||8===o.resizerSize?8:o.resizerSize)/2,t.width=(sf.base.isNullOrUndefined(o.resizerSize)||8===o.resizerSize?8:o.resizerSize)*n.scale,t.height=(sf.base.isNullOrUndefined(o.resizerSize)||8===o.resizerSize?8:o.resizerSize)*n.scale,"Line"===e&&this.pdfViewer.lineSettings.annotationSelectorSettings?(t.radius=(sf.base.isNullOrUndefined(this.pdfViewer.lineSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.lineSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.lineSettings.annotationSelectorSettings.resizerSize)/2,t.width=(sf.base.isNullOrUndefined(this.pdfViewer.lineSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.lineSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.lineSettings.annotationSelectorSettings.resizerSize)*n.scale,t.height=(sf.base.isNullOrUndefined(this.pdfViewer.lineSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.lineSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.lineSettings.annotationSelectorSettings.resizerSize)*n.scale):"LineWidthArrowHead"===e&&this.pdfViewer.arrowSettings.annotationSelectorSettings?(t.radius=(sf.base.isNullOrUndefined(this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerSize)/2,t.width=(sf.base.isNullOrUndefined(this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerSize)*n.scale,t.height=(sf.base.isNullOrUndefined(this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerSize)*n.scale):"Rectangle"===e&&this.pdfViewer.rectangleSettings.annotationSelectorSettings?(t.radius=(sf.base.isNullOrUndefined(this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerSize)/2,t.width=(sf.base.isNullOrUndefined(this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerSize)*n.scale,t.height=(sf.base.isNullOrUndefined(this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerSize)*n.scale):"Ellipse"===e&&this.pdfViewer.circleSettings.annotationSelectorSettings?(t.radius=(sf.base.isNullOrUndefined(this.pdfViewer.circleSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.circleSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.circleSettings.annotationSelectorSettings.resizerSize)/2,t.width=(sf.base.isNullOrUndefined(this.pdfViewer.circleSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.circleSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.circleSettings.annotationSelectorSettings.resizerSize)*n.scale,t.height=(sf.base.isNullOrUndefined(this.pdfViewer.circleSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.circleSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.circleSettings.annotationSelectorSettings.resizerSize)*n.scale):"Distance"===e&&this.pdfViewer.distanceSettings.annotationSelectorSettings?(t.radius=(sf.base.isNullOrUndefined(this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerSize)/2,t.width=(sf.base.isNullOrUndefined(this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerSize)*n.scale,t.height=(sf.base.isNullOrUndefined(this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerSize)*n.scale):"Polygon"===e&&this.pdfViewer.polygonSettings.annotationSelectorSettings?(t.radius=(sf.base.isNullOrUndefined(this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerSize)/2,t.width=(sf.base.isNullOrUndefined(this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerSize)*n.scale,t.height=(sf.base.isNullOrUndefined(this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerSize)*n.scale):"Radius"===e&&this.pdfViewer.radiusSettings.annotationSelectorSettings?(t.radius=(sf.base.isNullOrUndefined(this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerSize)/2,t.width=(sf.base.isNullOrUndefined(this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerSize)*n.scale,t.height=(sf.base.isNullOrUndefined(this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerSize)*n.scale):"Stamp"===e&&this.pdfViewer.stampSettings.annotationSelectorSettings?(t.radius=(sf.base.isNullOrUndefined(this.pdfViewer.stampSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.stampSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.stampSettings.annotationSelectorSettings.resizerSize)/2,t.width=(sf.base.isNullOrUndefined(this.pdfViewer.stampSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.stampSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.stampSettings.annotationSelectorSettings.resizerSize)*n.scale,t.height=(sf.base.isNullOrUndefined(this.pdfViewer.stampSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.stampSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.stampSettings.annotationSelectorSettings.resizerSize)*n.scale):"FreeText"===e&&this.pdfViewer.freeTextSettings.annotationSelectorSettings?(t.radius=(sf.base.isNullOrUndefined(this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerSize)/2,t.width=(sf.base.isNullOrUndefined(this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerSize)*n.scale,t.height=(sf.base.isNullOrUndefined(this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerSize)*n.scale):"HandWrittenSignature"===e&&this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings?(t.radius=(sf.base.isNullOrUndefined(this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerSize)/2,t.width=(sf.base.isNullOrUndefined(this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerSize)*n.scale,t.height=(sf.base.isNullOrUndefined(this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerSize)*n.scale):"Perimeter"===e&&this.pdfViewer.perimeterSettings.annotationSelectorSettings?(t.radius=(sf.base.isNullOrUndefined(this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerSize)/2,t.width=(sf.base.isNullOrUndefined(this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerSize)*n.scale,t.height=(sf.base.isNullOrUndefined(this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerSize)*n.scale):"Area"===e&&this.pdfViewer.areaSettings.annotationSelectorSettings?(t.radius=(sf.base.isNullOrUndefined(this.pdfViewer.areaSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.areaSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.areaSettings.annotationSelectorSettings.resizerSize)/2,t.width=(sf.base.isNullOrUndefined(this.pdfViewer.areaSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.areaSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.areaSettings.annotationSelectorSettings.resizerSize)*n.scale,t.height=(sf.base.isNullOrUndefined(this.pdfViewer.areaSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.areaSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.areaSettings.annotationSelectorSettings.resizerSize)*n.scale):"Volume"===e&&this.pdfViewer.volumeSettings.annotationSelectorSettings&&(t.radius=(sf.base.isNullOrUndefined(this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerSize)/2,t.width=(sf.base.isNullOrUndefined(this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerSize)*n.scale,t.height=(sf.base.isNullOrUndefined(this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerSize)||8===this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerSize?8:this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerSize)*n.scale)}},e.prototype.getShape=function(e,t){var i;if(t&&"object"!==r()(t)&&""!==t){var n=JSON.parse(t);i=sf.base.isNullOrUndefined(n.resizerShape)||"Square"===n.resizerShape?"Square":n.resizerShape}else{n=this.pdfViewer.annotationSelectorSettings;i=sf.base.isNullOrUndefined(n.resizerShape)||"Square"===n.resizerShape?"Square":n.resizerShape,"Line"===e&&this.pdfViewer.lineSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.lineSettings.annotationSelectorSettings.resizerShape)||"Square"===this.pdfViewer.lineSettings.annotationSelectorSettings.resizerShape?"Square":this.pdfViewer.lineSettings.annotationSelectorSettings.resizerShape:"LineWidthArrowHead"===e&&this.pdfViewer.arrowSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerShape)||"Square"===this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerShape?"Square":this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerShape:"Rectangle"===e&&this.pdfViewer.rectangleSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerShape)||"Square"===this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerShape?"Square":this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerShape:"Ellipse"===e&&this.pdfViewer.circleSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.circleSettings.annotationSelectorSettings.resizerShape)||"Square"===this.pdfViewer.circleSettings.annotationSelectorSettings.resizerShape?"Square":this.pdfViewer.circleSettings.annotationSelectorSettings.resizerShape:"Polygon"===e&&this.pdfViewer.polygonSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerShape)||"Square"===this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerShape?"Square":this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerShape:"Distance"===e&&this.pdfViewer.distanceSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerShape)||"Square"===this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerShape?"Square":this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerShape:"Radius"===e&&this.pdfViewer.radiusSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerShape)||"Square"===this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerShape?"Square":this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerShape:"Stamp"===e&&this.pdfViewer.stampSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.stampSettings.annotationSelectorSettings.resizerShape)||"Square"===this.pdfViewer.stampSettings.annotationSelectorSettings.resizerShape?"Square":this.pdfViewer.stampSettings.annotationSelectorSettings.resizerShape:"FreeText"===e&&this.pdfViewer.freeTextSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerShape)||"Square"===this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerShape?"Square":this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerShape:"HandWrittenSignature"===e&&this.pdfViewer.handWrittenSignatureSettings&&this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerShape)||"Square"===this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerShape?"Square":this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerShape:"Perimeter"===e&&this.pdfViewer.perimeterSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerShape)||"Square"===this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerShape?"Square":this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerShape:"Area"===e&&this.pdfViewer.areaSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.areaSettings.annotationSelectorSettings.resizerShape)||"Square"===this.pdfViewer.areaSettings.annotationSelectorSettings.resizerShape?"Square":this.pdfViewer.areaSettings.annotationSelectorSettings.resizerShape:"Volume"===e&&this.pdfViewer.volumeSettings.annotationSelectorSettings&&(i=sf.base.isNullOrUndefined(this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerShape)||"Square"===this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerShape?"Square":this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerShape)}return i},e.prototype.getResizerColors=function(e,t,i,n){if(i&&"object"!==r()(i)&&""!==i){var o=JSON.parse(i);t.stroke=sf.base.isNullOrUndefined(o.resizerBorderColor)||"black"===o.resizerBorderColor?"black":o.resizerBorderColor,t.fill=sf.base.isNullOrUndefined(o.resizerFillColor)||"#FF4081"===o.resizerFillColor?"#FF4081":o.resizerFillColor}else{o=this.pdfViewer.annotationSelectorSettings;t.stroke=sf.base.isNullOrUndefined(o.resizerBorderColor)||"black"===o.resizerBorderColor?"black":o.resizerBorderColor,t.fill=sf.base.isNullOrUndefined(o.resizerFillColor)||"#FF4081"===o.resizerFillColor?"#FF4081":o.resizerFillColor,"Line"===e&&this.pdfViewer.lineSettings.annotationSelectorSettings?(t.stroke=sf.base.isNullOrUndefined(this.pdfViewer.lineSettings.annotationSelectorSettings.resizerBorderColor)||"black"===this.pdfViewer.lineSettings.annotationSelectorSettings.resizerBorderColor?"black":this.pdfViewer.lineSettings.annotationSelectorSettings.resizerBorderColor,t.fill=sf.base.isNullOrUndefined(this.pdfViewer.lineSettings.annotationSelectorSettings.resizerFillColor)||"#FF4081"===this.pdfViewer.lineSettings.annotationSelectorSettings.resizerFillColor?"#FF4081":this.pdfViewer.lineSettings.annotationSelectorSettings.resizerFillColor):"LineWidthArrowHead"===e&&this.pdfViewer.arrowSettings.annotationSelectorSettings?(t.stroke=sf.base.isNullOrUndefined(this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerBorderColor)||"black"===this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerBorderColor?"black":this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerBorderColor,t.fill=sf.base.isNullOrUndefined(this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerFillColor)||"#FF4081"===this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerFillColor?"#FF4081":this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerFillColor):"Rectangle"===e&&this.pdfViewer.rectangleSettings.annotationSelectorSettings?(t.stroke=sf.base.isNullOrUndefined(this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerBorderColor)||"black"===this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerBorderColor?"black":this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerBorderColor,t.fill=sf.base.isNullOrUndefined(this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerFillColor)||"#FF4081"===this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerFillColor?"#FF4081":this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerFillColor):"Ellipse"===e&&this.pdfViewer.circleSettings.annotationSelectorSettings?(t.stroke=sf.base.isNullOrUndefined(this.pdfViewer.circleSettings.annotationSelectorSettings.resizerBorderColor)||"black"===this.pdfViewer.circleSettings.annotationSelectorSettings.resizerBorderColor?"black":this.pdfViewer.circleSettings.annotationSelectorSettings.resizerBorderColor,t.fill=sf.base.isNullOrUndefined(this.pdfViewer.circleSettings.annotationSelectorSettings.resizerFillColor)||"#FF4081"===this.pdfViewer.circleSettings.annotationSelectorSettings.resizerFillColor?"#FF4081":this.pdfViewer.circleSettings.annotationSelectorSettings.resizerFillColor):"Distance"===e&&this.pdfViewer.distanceSettings.annotationSelectorSettings?(t.stroke=sf.base.isNullOrUndefined(this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerBorderColor)||"black"===this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerBorderColor?"black":this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerBorderColor,t.fill=sf.base.isNullOrUndefined(this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerFillColor)||"#FF4081"===this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerFillColor?"#FF4081":this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerFillColor):"Polygon"===e&&this.pdfViewer.polygonSettings.annotationSelectorSettings?(t.stroke=sf.base.isNullOrUndefined(this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerBorderColor)||"black"===this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerBorderColor?"black":this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerBorderColor,t.fill=sf.base.isNullOrUndefined(this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerFillColor)||"#FF4081"===this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerFillColor?"#FF4081":this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerFillColor):"Radius"===e&&this.pdfViewer.radiusSettings.annotationSelectorSettings?(t.stroke=sf.base.isNullOrUndefined(this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerBorderColor)||"black"===this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerBorderColor?"black":this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerBorderColor,t.fill=sf.base.isNullOrUndefined(this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerFillColor)||"#FF4081"===this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerFillColor?"#FF4081":this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerFillColor):"Stamp"===e&&this.pdfViewer.stampSettings.annotationSelectorSettings?(t.stroke=sf.base.isNullOrUndefined(this.pdfViewer.stampSettings.annotationSelectorSettings.resizerBorderColor)||"black"===this.pdfViewer.stampSettings.annotationSelectorSettings.resizerBorderColor?"black":this.pdfViewer.stampSettings.annotationSelectorSettings.resizerBorderColor,t.fill=sf.base.isNullOrUndefined(this.pdfViewer.stampSettings.annotationSelectorSettings.resizerFillColor)||"#FF4081"===this.pdfViewer.stampSettings.annotationSelectorSettings.resizerFillColor?"#FF4081":this.pdfViewer.stampSettings.annotationSelectorSettings.resizerFillColor):"FreeText"===e&&this.pdfViewer.freeTextSettings.annotationSelectorSettings?(t.stroke=sf.base.isNullOrUndefined(this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerBorderColor)||"black"===this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerBorderColor?"black":this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerBorderColor,t.fill=sf.base.isNullOrUndefined(this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerFillColor)||"#FF4081"===this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerFillColor?"#FF4081":this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerFillColor):"HandWrittenSignature"===e&&this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings?(t.stroke=sf.base.isNullOrUndefined(this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerBorderColor)||"black"===this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerBorderColor?"black":this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerBorderColor,t.fill=sf.base.isNullOrUndefined(this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerFillColor)||"#FF4081"===this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerFillColor?"#FF4081":this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerFillColor):"Perimeter"===e&&this.pdfViewer.perimeterSettings.annotationSelectorSettings?(t.stroke=sf.base.isNullOrUndefined(this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerBorderColor)||"black"===this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerBorderColor?"black":this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerBorderColor,t.fill=sf.base.isNullOrUndefined(this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerFillColor)||"#FF4081"===this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerFillColor?"#FF4081":this.pdfViewer.perimeterSettings.annotationSelectorSettings.resizerFillColor):"Area"===e&&this.pdfViewer.areaSettings.annotationSelectorSettings?(t.stroke=sf.base.isNullOrUndefined(this.pdfViewer.areaSettings.annotationSelectorSettings.resizerBorderColor)||"black"===this.pdfViewer.areaSettings.annotationSelectorSettings.resizerBorderColor?"black":this.pdfViewer.areaSettings.annotationSelectorSettings.resizerBorderColor,t.fill=sf.base.isNullOrUndefined(this.pdfViewer.areaSettings.annotationSelectorSettings.resizerFillColor)||"#FF4081"===this.pdfViewer.areaSettings.annotationSelectorSettings.resizerFillColor?"#FF4081":this.pdfViewer.areaSettings.annotationSelectorSettings.resizerFillColor):"Volume"===e&&this.pdfViewer.volumeSettings.annotationSelectorSettings&&(t.stroke=sf.base.isNullOrUndefined(this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerBorderColor)||"black"===this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerBorderColor?"black":this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerBorderColor,t.fill=sf.base.isNullOrUndefined(this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerFillColor)||"#FF4081"===this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerFillColor?"#FF4081":this.pdfViewer.volumeSettings.annotationSelectorSettings.resizerFillColor)}},e.prototype.renderRotateThumb=function(e,t,i,n,r){new sf.drawings.PathElement;var o,s=e.offsetY-e.actualSize.height*e.pivot.y,a=e.offsetX-e.actualSize.width*e.pivot.x+e.pivot.x*e.actualSize.width,d=s;if(o={x:a=(a+i.tx)*i.scale,y:(d=(d+i.ty)*i.scale)-25},0!==e.rotateAngle||0!==e.parentTransform){var l=sf.drawings.identityMatrix();sf.drawings.rotateMatrix(l,e.rotateAngle+e.parentTransform,(i.tx+e.offsetX)*i.scale,(i.ty+e.offsetY)*i.scale),o=sf.drawings.transformPointByMatrix(l,o)}var h=u(e);h.stroke="black",h.strokeWidth=1,h.opacity=1,h.fill="#FF4081",h.centerX=o.x,h.centerY=o.y,h.radius=4,h.angle=0,h.visible=!0,h.class="e-diagram-rotate-handle",h.id="rotateThumb",this.svgRenderer.drawCircle(t,h,sf.drawings.ThumbsConstraints.Rotate,{"aria-label":"Thumb to rotate the selected object"})},e.prototype.renderResizeHandle=function(e,t,i,n,r,o,s,a,d,l,h,c){var p=e.offsetX-e.actualSize.width*e.pivot.x,f=e.offsetY-e.actualSize.height*e.pivot.y,g=e.actualSize.height,S=e.actualSize.width,u={scale:n,tx:0,ty:0};a&&(this.renderPivotLine(e,t,u),this.renderRotateThumb(e,t,u)),h&&(a=!0),this.renderBorder(e,t,c,u,o,s,!0,d);var w=e.actualSize.width*n,m=e.actualSize.height*n,y=this.pdfViewer.selectedItems.annotations[0].shapeAnnotationType,v=this.getResizerLocation(y,c);(v<1||v>3)&&(v=3);var b=!1;!this.pdfViewer.selectedItems.annotations[0]||"Ellipse"!==this.pdfViewer.selectedItems.annotations[0].shapeAnnotationType&&"Radius"!==this.pdfViewer.selectedItems.annotations[0].shapeAnnotationType&&"Rectangle"!==this.pdfViewer.selectedItems.annotations[0].shapeAnnotationType||(b=!0),s||d||l||((a||b&&w>=40&&m>=40&&(1===v||3===v))&&(this.renderCircularHandle("resizeNorthWest",e,p,f,t,!0,i&sf.drawings.ThumbsConstraints.ResizeNorthWest,u,void 0,r,{"aria-label":"Thumb to resize the selected object on top left side direction"},void 0,"e-pv-diagram-resize-handle e-northwest",c),this.renderCircularHandle("resizeNorthEast",e,p+S,f,t,!0,i&sf.drawings.ThumbsConstraints.ResizeNorthEast,u,void 0,r,{"aria-label":"Thumb to resize the selected object on top right side direction"},void 0,"e-pv-diagram-resize-handle e-northeast",c),this.renderCircularHandle("resizeSouthWest",e,p,f+g,t,!0,i&sf.drawings.ThumbsConstraints.ResizeSouthWest,u,void 0,r,{"aria-label":"Thumb to resize the selected object on bottom left side direction"},void 0,"e-pv-diagram-resize-handle e-southwest",c),this.renderCircularHandle("resizeSouthEast",e,p+S,f+g,t,!0,i&sf.drawings.ThumbsConstraints.ResizeSouthEast,u,void 0,r,{"aria-label":"Thumb to resize the selected object on bottom right side direction"},void 0,"e-pv-diagram-resize-handle e-southeast",c)),(a||b)&&(!b||2!==v&&3!==v&&(w>=40&&m>=40||1!==v))||(this.renderCircularHandle("resizeNorth",e,p+S/2,f,t,!0,i&sf.drawings.ThumbsConstraints.ResizeNorth,u,void 0,r,{"aria-label":"Thumb to resize the selected object on top side direction"},void 0,"e-pv-diagram-resize-handle e-north",c),this.renderCircularHandle("resizeSouth",e,p+S/2,f+g,t,!0,i&sf.drawings.ThumbsConstraints.ResizeSouth,u,void 0,r,{"aria-label":"Thumb to resize the selected object on bottom side direction"},void 0,"e-pv-diagram-resize-handle e-south",c),this.renderCircularHandle("resizeWest",e,p,f+g/2,t,!0,i&sf.drawings.ThumbsConstraints.ResizeWest,u,void 0,r,{"aria-label":"Thumb to resize the selected object on left side direction"},void 0,"e-pv-diagram-resize-handle e-west",c),this.renderCircularHandle("resizeEast",e,p+S,f+g/2,t,!0,i&sf.drawings.ThumbsConstraints.ResizeEast,u,void 0,r,{"aria-label":"Thumb to resize the selected object on right side direction"},void 0,"e-pv-diagram-resize-handle e-east",c)))},e.prototype.getResizerLocation=function(e,t){var i;if(t&&"object"!==r()(t)&&""!==t){var n=JSON.parse(t);i=sf.base.isNullOrUndefined(n.resizerLocation)||3===n.resizerLocation?3:n.resizerLocation}else{n=this.pdfViewer.annotationSelectorSettings;i=sf.base.isNullOrUndefined(n.resizerLocation)||3===n.resizerLocation?3:n.resizerLocation,"Line"===e&&this.pdfViewer.lineSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.lineSettings.annotationSelectorSettings.resizerLocation)||3===this.pdfViewer.lineSettings.annotationSelectorSettings.resizerLocation?3:this.pdfViewer.lineSettings.annotationSelectorSettings.resizerLocation:"LineWidthArrowHead"===e&&this.pdfViewer.arrowSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerLocation)||3===this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerLocation?3:this.pdfViewer.arrowSettings.annotationSelectorSettings.resizerLocation:"Rectangle"===e&&this.pdfViewer.rectangleSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerLocation)||3===this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerLocation?3:this.pdfViewer.rectangleSettings.annotationSelectorSettings.resizerLocation:"Ellipse"===e&&this.pdfViewer.circleSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.circleSettings.annotationSelectorSettings.resizerLocation)||3===this.pdfViewer.circleSettings.annotationSelectorSettings.resizerLocation?3:this.pdfViewer.circleSettings.annotationSelectorSettings.resizerLocation:"Polygon"===e&&this.pdfViewer.polygonSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerLocation)||3===this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerLocation?3:this.pdfViewer.polygonSettings.annotationSelectorSettings.resizerLocation:"Distance"===e?i=sf.base.isNullOrUndefined(this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerLocation)||3===this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerLocation?3:this.pdfViewer.distanceSettings.annotationSelectorSettings.resizerLocation:"Radius"===e&&this.pdfViewer.radiusSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerLocation)||3===this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerLocation?3:this.pdfViewer.radiusSettings.annotationSelectorSettings.resizerLocation:"Stamp"===e&&this.pdfViewer.stampSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.stampSettings.annotationSelectorSettings.resizerLocation)||3===this.pdfViewer.stampSettings.annotationSelectorSettings.resizerLocation?3:this.pdfViewer.stampSettings.annotationSelectorSettings.resizerLocation:"FreeText"===e&&this.pdfViewer.freeTextSettings.annotationSelectorSettings?i=sf.base.isNullOrUndefined(this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerLocation)||3===this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerLocation?3:this.pdfViewer.freeTextSettings.annotationSelectorSettings.resizerLocation:"HandWrittenSignature"===e&&this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings&&(i=sf.base.isNullOrUndefined(this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerLocation)||3===this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerLocation?3:this.pdfViewer.handWrittenSignatureSettings.annotationSelectorSettings.resizerLocation)}return i},e.prototype.renderPivotLine=function(e,t,i,n,r){var o=e,s=!0;r&&(s=!1);var a=u(o,i);a.fill="None",a.stroke="black",a.strokeWidth=1,a.dashArray="2,3",a.visible=s;var d=i.scale;a.x*=d,a.y*=d,a.width*=d,a.height*=d,a.id="pivotLine",a.class="e-diagram-pivot-line";var l={x:o.actualSize.width*o.pivot.x*d,y:-20},h={x:o.actualSize.width*o.pivot.x*d,y:0};a.startPoint=l,a.endPoint=h,this.svgRenderer.drawLine(t,a)},e.prototype.renderEndPointHandle=function(e,t,i,n,r,o,s,a){n=n||{tx:0,ty:0,scale:1};var d,l=e.sourcePoint,h=e.targetPoint,c=e.wrapper;for(d=0;d<e.vertexPoints.length;d++){var p=e.vertexPoints[d];this.renderCircularHandle("segementThumb_"+(d+1),c,p.x,p.y,t,!0,i&sf.drawings.ThumbsConstraints.ConnectorSource,n,r,null,null,d,null,a)}var f=0;if("Distance"===e.shapeAnnotationType)for(d=0;d<e.wrapper.children.length;d++){p=e.wrapper.children[d];var g=void 0,S=sf.drawings.Point.findAngle(e.sourcePoint,e.targetPoint);if(p.id.indexOf("leader")>-1){var u=e.wrapper.children[0].bounds.center;0===f?(g={x:e.sourcePoint.x,y:e.sourcePoint.y-e.leaderHeight},u=l):(g={x:e.targetPoint.x,y:e.targetPoint.y-e.leaderHeight},u=h);var w=sf.drawings.identityMatrix();sf.drawings.rotateMatrix(w,S,u.x,u.y);var m=sf.drawings.transformPointByMatrix(w,{x:g.x,y:g.y});this.renderCircularHandle("leaderThumb_"+(d+1),c,m.x,m.y,t,!0,i&sf.drawings.ThumbsConstraints.ConnectorSource,n,r,null,null,d,null,a),f++}}},e.prototype.initSelectorWrapper=function(){this.pdfViewer.selectedItems.init(this)},e.prototype.select=function(e,t,i,n){for(var r=this.pdfViewer.selectedItems,o=0;o<e.length;o++){var s=this.pdfViewer.nameTable[e[o]];if(s&&!(s instanceof p)&&s.wrapper.visible){var a=void 0;s.annotationSettings?(a=s.annotationSettings).isLock=JSON.parse(a.isLock):(a=this.pdfViewer.annotationModule.findAnnotationSettings(s,!0),s.annotationSettings=a),a.isLock||(r.annotations.push(s),this.initSelectorWrapper(),r.wrapper.rotateAngle=r.rotateAngle=0,r.wrapper.children.push(s.wrapper),n||this.renderSelector(s.pageIndex,t,s,!0))}}},e.prototype.dragSelectedObjects=function(e,t,i,n,r){var o=this.pdfViewer.selectedItems;return this.drag(o,e,t,n,r),!0},e.prototype.drag=function(e,t,i,n,r){if(e instanceof p){if(e.annotations.length)for(var o=0,s=e.annotations;o<s.length;o++){var a=s[o];this.drag(a,t,i,n,r),this.renderSelector(a.pageIndex,n,r)}}else this.dragAnnotation(e,t,i)},e.prototype.dragAnnotation=function(e,t,i){e.wrapper.offsetX,e.wrapper.offsetY;if(e.wrapper.offsetX+=t,e.wrapper.offsetY+=i,f(e)||"Polygon"===e.shapeAnnotationType){if(e.wrapper.children.length)for(var n=e.wrapper.children,r=0;r<n.length;r++)n[r].offsetX+=t,n[r].offsetY+=i;this.dragControlPoint(e,t,i,!0)}this.nodePropertyChange(e,{bounds:{x:e.wrapper.offsetX,y:e.wrapper.offsetY}}),e.wrapper.measureChildren=!1;var o=document.getElementById(this.pdfViewer.element.id+"_annotationCanvas_"+e.pageIndex);this.pdfViewer.renderDrawing(o,e.pageIndex)},e.prototype.dragControlPoint=function(e,t,i,n,r){for(var o=this.pdfViewer.nameTable[e.id],s=0;s<o.vertexPoints.length;s++)o.vertexPoints[s].x+=t,o.vertexPoints[s].y+=i;return n||this.updateEndPoint(o),!0},e.prototype.updateEndPoint=function(e){this.nodePropertyChange(e,{vertexPoints:e.vertexPoints}),this.renderSelector(e.pageIndex)},e.prototype.nodePropertyChange=function(e,t){var i;e.wrapper.outerBounds,e.wrapper.bounds;if(t.bounds&&(void 0!==t.bounds.width&&(e.bounds.width=e.wrapper.width=t.bounds.width),void 0!==t.bounds.height&&(e.bounds.height=e.wrapper.height=t.bounds.height),void 0!==t.bounds.x&&(e.bounds.x=t.bounds.x-.5*e.bounds.width,e.wrapper.offsetX=t.bounds.x),void 0!==t.bounds.y&&(e.bounds.y=t.bounds.y-.5*e.bounds.height,e.wrapper.offsetY=t.bounds.y),void 0!==t.leaderHeight&&(e.leaderHeight=t.leaderHeight,this.updateConnector(e,e.vertexPoints)),e.wrapper.children.length))for(var n=e.wrapper.children,r=0;r<n.length;r++)if(n[r].id){var o=n[r].id.split("_");if(o.length&&(o.indexOf("perimeter")>-1||o.indexOf("radius")>-1))this.setNodePosition(n[r],e);else if(o.length&&o.indexOf("srcDec")>-1)n[r].offsetX=e.vertexPoints[0].x,n[r].offsetY=e.vertexPoints[0].y;else if(o.length&&o.indexOf("tarDec")>-1)n[r].offsetX=e.vertexPoints[e.vertexPoints.length-1].x,n[r].offsetY=e.vertexPoints[e.vertexPoints.length-1].y;else if(o.length&&o.indexOf("stamp")>-1){var s=0,a=2;if(null!=e.wrapper.width&&null!=e.wrapper.height&&(s=20,a=2.9),e.isDynamicStamp){n[r].width=e.bounds.width-s,n[r].height=e.bounds.height/2-s;var d=n[1],l=this.pdfViewer.stampSettings?this.pdfViewer.stampSettings:this.pdfViewer.annotationSettings;l&&(l.maxHeight||l.maxWidth)&&e.bounds.height>60?3*e.bounds.height<e.bounds.width?d.style.fontSize=e.bounds.height/2/a:e.bounds.height>e.bounds.width?d.style.fontSize=e.bounds.width/8/a:2*e.bounds.height<e.bounds.width?d.style.fontSize=e.bounds.height/4/a:d.style.fontSize=e.bounds.height/6/a:d.style.fontSize=e.bounds.height/2/a,0!=s&&(d.margin.bottom=-n[r].height/2)}else n[r].width=e.bounds.width-s,n[r].height=e.bounds.height-s;n[r].offsetX=e.wrapper.offsetX,n[r].offsetY=e.wrapper.offsetX,n[r].isDirt=!0}}if(void 0!==t.sourceDecoraterShapes&&(e.sourceDecoraterShapes=t.sourceDecoraterShapes,this.updateConnector(e,e.vertexPoints)),void 0!==t.taregetDecoraterShapes&&(e.taregetDecoraterShapes=t.taregetDecoraterShapes,this.updateConnector(e,e.vertexPoints)),void 0!==t.fillColor&&(e.fillColor=t.fillColor,e.wrapper.children[0].style.fill=t.fillColor,(e.enableShapeLabel||e.measureType)&&e.wrapper&&e.wrapper.children))for(var n=e.wrapper.children,h=0;h<n.length;h++)n[h].textNodes&&(e.enableShapeLabel&&(e.labelFillColor=t.fillColor,n[h].style.fill=t.fillColor),e.measureType&&(n[h].style.fill=t.fillColor));if(e.enableShapeLabel&&void 0!==t.labelFillColor&&e.enableShapeLabel&&e.wrapper&&e.wrapper.children)for(var n=e.wrapper.children,c=0;c<n.length;c++)n[c].textNodes&&(n[c].style.fill=t.labelFillColor);if(void 0!==t.opacity&&("Stamp"==e.shapeAnnotationType||"FreeText"===e.shapeAnnotationType?(e.wrapper.children[1].style.opacity=t.opacity,e.wrapper.children[2]&&(e.wrapper.children[2].style.opacity=t.opacity)):e.opacity=t.opacity,e.wrapper.children[0].style.opacity=t.opacity,e.enableShapeLabel&&e.wrapper&&e.wrapper.children)){n=e.wrapper.children;for(var p=0;p<n.length;p++)n[p].textNodes&&(n[p].style.opacity=t.labelOpacity)}if(e.enableShapeLabel&&void 0!==t.labelOpacity&&e.enableShapeLabel&&e.wrapper&&e.wrapper.children){n=e.wrapper.children;for(var S=0;S<n.length;S++)n[S].textNodes&&(n[S].style.opacity=t.labelOpacity)}if(void 0!==t.rotateAngle&&(e.rotateAngle=t.rotateAngle,e.wrapper.rotateAngle=t.rotateAngle),void 0!==t.strokeColor&&(e.strokeColor=t.strokeColor,e.wrapper.children[0].style.strokeColor=t.strokeColor),void 0!==t.fontColor){if(e.fontColor=t.fontColor,"FreeText"===e.shapeAnnotationType&&e.wrapper&&e.wrapper.children&&e.wrapper.children.length)(n=e.wrapper.children)[1].style.color=t.fontColor,"Justify"===e.textAlign?n[1].horizontalAlignment="Center":n[1].horizontalAlignment="Auto";if(e.enableShapeLabel&&e.wrapper&&e.wrapper.children){n=e.wrapper.children;for(var u=0;u<n.length;u++)n[u].textNodes&&(n[u].style.color=t.fontColor)}}if(void 0!==t.fontFamily){if(e.fontFamily=t.fontFamily,"FreeText"===e.shapeAnnotationType&&e.wrapper&&e.wrapper.children&&e.wrapper.children.length)(n=e.wrapper.children)[1].style.fontFamily=t.fontFamily;if(e.enableShapeLabel&&e.wrapper&&e.wrapper.children){n=e.wrapper.children;for(var w=0;w<n.length;w++)n[w].textNodes&&(n[w].style.fontFamily=t.fontFamily)}}if(void 0!==t.fontSize){if(e.fontSize=t.fontSize,"FreeText"===e.shapeAnnotationType&&e.wrapper&&e.wrapper.children&&e.wrapper.children.length)(n=e.wrapper.children)[1].style.fontSize=t.fontSize;if(e.enableShapeLabel&&e.wrapper&&e.wrapper.children){n=e.wrapper.children;for(var m=0;m<n.length;m++)n[m].textNodes&&(n[m].style.fontSize=t.fontSize)}}if(void 0!==t.font&&"FreeText"===e.shapeAnnotationType&&e.wrapper&&e.wrapper.children&&e.wrapper.children.length){n=e.wrapper.children;void 0!==t.font.isBold&&(n[1].style.bold=t.font.isBold,e.font.isBold=t.font.isBold),void 0!==t.font.isItalic&&(n[1].style.italic=t.font.isItalic,e.font.isItalic=t.font.isItalic),void 0!==t.font.isUnderline&&(e.font.isStrikeout=!1,!0===t.font.isUnderline?n[1].style.textDecoration="Underline":n[1].style.textDecoration="None",e.font.isUnderline=t.font.isUnderline),void 0!==t.font.isStrikeout&&(e.font.isUnderline=!1,!0===t.font.isStrikeout?n[1].style.textDecoration="LineThrough":n[1].style.textDecoration="None",e.font.isStrikeout=t.font.isStrikeout)}void 0!==t.textAlign&&(e.textAlign=t.textAlign,"FreeText"===e.shapeAnnotationType&&e.wrapper&&e.wrapper.children&&e.wrapper.children.length&&((n=e.wrapper.children)[1].style.textAlign=t.textAlign,1===n[1].childNodes.length?"Justify"===e.textAlign?(n[1].horizontalAlignment="Left",n[1].setOffsetWithRespectToBounds(0,0,null)):"Right"===e.textAlign?(n[1].horizontalAlignment="Right",n[1].setOffsetWithRespectToBounds(.97,0,null)):"Left"===e.textAlign?(n[1].horizontalAlignment="Left",n[1].setOffsetWithRespectToBounds(0,0,null)):"Center"===e.textAlign&&(n[1].horizontalAlignment="Center",n[1].setOffsetWithRespectToBounds(.46,0,null)):n[1].childNodes.length>1&&"Justify"===e.textAlign?n[1].horizontalAlignment="Center":n[1].horizontalAlignment="Auto"));if(void 0!==t.thickness&&(e.thickness=t.thickness,e.wrapper.children[0].style.strokeWidth=t.thickness),void 0!==t.borderDashArray&&(e.borderDashArray=t.borderDashArray,e.wrapper.children[0].style.strokeDashArray=t.borderDashArray),void 0!==t.borderStyle&&(e.borderStyle=t.borderStyle),void 0!==t.vertexPoints&&(e.vertexPoints=t.vertexPoints,this.pdfViewer.nameTable[e.id].vertexPoints=t.vertexPoints,this.updateConnector(e,t.vertexPoints)),void 0!==t.leaderHeight&&"Polygon"!==e.shapeAnnotationType&&(e.leaderHeight=t.leaderHeight,this.updateConnector(e,e.vertexPoints)),void 0!==t.notes&&(e.notes=t.notes),void 0!==t.annotName&&(e.annotName=t.annotName),"Distance"===e.shapeAnnotationType){for(i=0;i<e.wrapper.children.length;i++){var y=e.wrapper.children[i],v=x(e);y.id.indexOf("leader1")>-1&&this.setLineDistance(e,v,y,!1),y.id.indexOf("leader2")>-1&&this.setLineDistance(e,v,y,!0)}this.updateConnector(e,e.vertexPoints)}if("Polygon"===e.shapeAnnotationType&&t.vertexPoints){e.data=N(e.vertexPoints);var b=e.wrapper.children[0];b.data=e.data,b.canMeasurePath=!0}if(f(e))for(var P=0;P<e.wrapper.children.length;P++){e.wrapper.children[P].textNodes||g(e,e.wrapper.children[P]),!0===e.enableShapeLabel?(e.wrapper.children[P]instanceof sf.drawings.TextElement&&(e.wrapper.children[P].style.fill=e.labelFillColor),e.wrapper.children[P]instanceof sf.drawings.PathElement&&"Perimeter"===e.measureType&&(e.wrapper.children[P].style.fill="transparent")):(e.wrapper.children[P]instanceof sf.drawings.PathElement&&"Perimeter"===e.measureType||e.wrapper.children[P]instanceof sf.drawings.TextElement)&&(e.wrapper.children[P].style.fill="transparent")}if(e&&("FreeText"===e.shapeAnnotationType||!0===e.enableShapeLabel)&&e.wrapper&&e.wrapper.children&&e.wrapper.children.length){n=e.wrapper.children;for(var z=0;z<n.length;z++)n[z].textNodes&&("FreeText"===e.shapeAnnotationType?(void 0!==t.dynamicText?(n[z].content=t.dynamicText,e.dynamicText=t.dynamicText):n[z].content=e.dynamicText,n[z].width=e.bounds.width-8):(!0===e.enableShapeLabel&&e.measureType||!0===e.enableShapeLabel)&&(t.labelContent?(n[z].content=t.labelContent,e.labelContent=t.labelContent):n[z].content=e.labelContent,e.notes=n[z].content),n[z].isDirt=!0)}if(e.wrapper.measure(new sf.drawings.Size(e.wrapper.bounds.width,e.wrapper.bounds.height)),e.wrapper.arrange(e.wrapper.desiredSize),e&&"FreeText"===e.shapeAnnotationType&&"Text Box"===e.subject){if(e.wrapper&&e.wrapper.children&&e.wrapper.children.length){(n=e.wrapper.children)[1].childNodes.length>1&&"Justify"===e.textAlign?n[1].horizontalAlignment="Center":1===n[1].childNodes.length&&("Justify"===e.textAlign?(n[1].horizontalAlignment="Left",n[1].setOffsetWithRespectToBounds(0,0,null)):"Right"===e.textAlign?(n[1].horizontalAlignment="Right",n[1].setOffsetWithRespectToBounds(.97,0,null)):"Left"===e.textAlign?(n[1].horizontalAlignment="Left",n[1].setOffsetWithRespectToBounds(0,0,null)):"Center"===e.textAlign&&(n[1].horizontalAlignment="Center",n[1].setOffsetWithRespectToBounds(.46,0,null)));for(var V=0;V<n.length;V++){if(n[V].textNodes&&n[V].textNodes.length>0){n[V].isDirt=!0;var A=n[V].textNodes.length*n[V].textNodes[0].dy,C=e.bounds.height-A;if(C>0&&C<n[V].textNodes[0].dy&&(A+=n[V].textNodes[0].dy),A>e.bounds.height){for(var O="",T=0;T<n[V].textNodes.length;T++){var H=n[V].textNodes[0].dy*(T+1);if((H=H)>e.bounds.height)break;O+=n[V].textNodes[T].text}n[V].content=O}}n[V].width=e.bounds.width-8}}e.wrapper.measure(new sf.drawings.Size(e.wrapper.bounds.width,e.wrapper.bounds.height)),e.wrapper.arrange(e.wrapper.desiredSize)}(this.pdfViewer.renderDrawing(void 0,e.pageIndex),e&&"FreeText"===e.shapeAnnotationType)&&(e.wrapper&&e.wrapper.children&&e.wrapper.children.length&&(1==(n=e.wrapper.children)[1].childNodes.length&&"Justify"===e.textAlign?(n[1].horizontalAlignment="Left",n[1].setOffsetWithRespectToBounds(.5,0,null)):n[1].childNodes.length>1&&"Justify"===e.textAlign&&(n[1].horizontalAlignment="Center",n[1].setOffsetWithRespectToBounds(0,0,null))))},e.prototype.setLineDistance=function(e,t,i,n){var r;r=n?L(e,t[1],t[0],n):L(e,t[0],t[1],n),i.data=r.data,i.offsetX=r.offsetX,i.offsetY=r.offsetY,i.rotateAngle=r.rotateAngle,i.width=r.width,i.height=r.height,i.pivot=r.pivot,i.canMeasurePath=!0,i.isDirt=!0},e.prototype.scaleSelectedItems=function(e,t,i){var n=this.pdfViewer.selectedItems;return this.scale(n,e,t,i)},e.prototype.scale=function(e,t,i,n){var r=!0;if(e instanceof p){if(e.annotations&&e.annotations.length)for(var o=0,s=e.annotations;o<s.length;o++){var a=s[o];r=this.scaleAnnotation(a,t,i,n,e)}}else r=this.scaleAnnotation(e,t,i,n,void 0);return r},e.prototype.scaleObject=function(e,t,i,n,r,o){if(t=t<0?1:t,1!==(e=e<0?1:e)||1!==t){var s=void 0,a=void 0;if(!f(n)){s=(h=n).wrapper.actualSize.width*e,a=h.wrapper.actualSize.height*t,e=s/h.wrapper.actualSize.width,t=a/h.wrapper.actualSize.height}var d,l=sf.drawings.identityMatrix();if(o||(o=n),d=o.wrapper,sf.drawings.rotateMatrix(l,-d.rotateAngle,i.x,i.y),sf.drawings.scaleMatrix(l,e,t,i.x,i.y),sf.drawings.rotateMatrix(l,d.rotateAngle,i.x,i.y),!f(n)){var h=n,c=sf.drawings.transformPointByMatrix(l,{x:h.wrapper.offsetX,y:h.wrapper.offsetY});h.wrapper.offsetX,h.wrapper.actualSize.width,h.wrapper.offsetY,h.wrapper.actualSize.height;s>0&&(h.wrapper.width=s,h.wrapper.offsetX=c.x),a>0&&(h.wrapper.height=a,h.wrapper.offsetY=c.y),h.wrapper.offsetX-h.wrapper.actualSize.width,h.wrapper.offsetY-h.wrapper.actualSize.height,this.nodePropertyChange(n,{bounds:{width:h.wrapper.width,height:h.wrapper.height,x:h.wrapper.offsetX,y:h.wrapper.offsetY}})}}},e.prototype.scaleAnnotation=function(e,t,i,n,r){var o=this.pdfViewer.nameTable[e.id],s=o.wrapper;r||(r=e);var a=r.wrapper,d=a.offsetX-a.actualSize.width*a.pivot.x,l=a.offsetY-a.actualSize.height*a.pivot.y,h=this.getShapePoint(d,l,a.actualSize.width,a.actualSize.height,a.rotateAngle,a.offsetX,a.offsetY,n);if(void 0!==s.actualSize.width&&void 0!==s.actualSize.height){this.scaleObject(t,i,h,o,s,r);this.getShapeBounds(e.wrapper)}var c=this.checkBoundaryConstraints(void 0,void 0,e.pageIndex,e.wrapper.bounds);return c||this.scaleObject(1/t,1/i,h,o,s,r),c},e.prototype.checkBoundaryConstraints=function(e,t,i,n,r){var o=n?void 0:this.pdfViewer.selectedItems.wrapper.bounds,s=n,a=document.getElementById(this.pdfViewer.element.id+"_annotationCanvas_"+i),d=10;if(a){var l=a.clientWidth/this.pdfViewer.viewerBase.getZoomFactor(),h=a.clientHeight/this.pdfViewer.viewerBase.getZoomFactor(),c=(n?s.right:o.right)+(e||0),p=(n?s.left:o.left)+(e||0),f=(n?s.top:o.top)+(t||0),g=(n?s.bottom:o.bottom)+(t||0);if(r&&(d=50,this.pdfViewer.viewerBase.eventArgs&&this.pdfViewer.viewerBase.eventArgs.source&&this.RestrictStamp(this.pdfViewer.viewerBase.eventArgs.source)))return!1;if(c<=l-10&&p>=10&&g<=h-10&&f>=d)return!0}return!1},e.prototype.RestrictStamp=function(e){return!(!e||void 0===e.pageIndex||!this.pdfViewer.viewerBase.activeElements||e.pageIndex===this.pdfViewer.viewerBase.activeElements.activePageID)},e.prototype.getShapeBounds=function(e){var t,i=new sf.drawings.Rect,n=(t=sf.drawings.cornersPointsBeforeRotation(e)).middleLeft,r=t.topCenter,o=t.bottomCenter,s=t.middleRight,a=t.topLeft,d=t.topRight,l=t.bottomLeft,h=t.bottomRight;if(e.corners={topLeft:a,topCenter:r,topRight:d,middleLeft:n,middleRight:s,bottomLeft:l,bottomCenter:o,bottomRight:h},0!==e.rotateAngle||0!==e.parentTransform){var c=sf.drawings.identityMatrix();sf.drawings.rotateMatrix(c,e.rotateAngle+e.parentTransform,e.offsetX,e.offsetY),e.corners.topLeft=a=sf.drawings.transformPointByMatrix(c,a),e.corners.topCenter=r=sf.drawings.transformPointByMatrix(c,r),e.corners.topRight=d=sf.drawings.transformPointByMatrix(c,d),e.corners.middleLeft=n=sf.drawings.transformPointByMatrix(c,n),e.corners.middleRight=s=sf.drawings.transformPointByMatrix(c,s),e.corners.bottomLeft=l=sf.drawings.transformPointByMatrix(c,l),e.corners.bottomCenter=o=sf.drawings.transformPointByMatrix(c,o),e.corners.bottomRight=h=sf.drawings.transformPointByMatrix(c,h)}return i=sf.drawings.Rect.toBounds([a,d,l,h]),e.corners.left=i.left,e.corners.right=i.right,e.corners.top=i.top,e.corners.bottom=i.bottom,e.corners.center=i.center,e.corners.width=i.width,e.corners.height=i.height,i},e.prototype.getShapePoint=function(e,t,i,n,r,o,s,a){var d={x:0,y:0},l=sf.drawings.identityMatrix();switch(sf.drawings.rotateMatrix(l,r,o,s),a.x){case 1:switch(a.y){case 1:d=sf.drawings.transformPointByMatrix(l,{x:e+i,y:t+n});break;case 0:d=sf.drawings.transformPointByMatrix(l,{x:e+i,y:t});break;case.5:d=sf.drawings.transformPointByMatrix(l,{x:e+i,y:t+n/2})}break;case 0:switch(a.y){case.5:d=sf.drawings.transformPointByMatrix(l,{x:e,y:t+n/2});break;case 1:d=sf.drawings.transformPointByMatrix(l,{x:e,y:t+n});break;case 0:d=sf.drawings.transformPointByMatrix(l,{x:e,y:t})}break;case.5:switch(a.y){case 0:d=sf.drawings.transformPointByMatrix(l,{x:e+i/2,y:t});break;case.5:d=sf.drawings.transformPointByMatrix(l,{x:e+i/2,y:t+n/2});break;case 1:d=sf.drawings.transformPointByMatrix(l,{x:e+i/2,y:t+n})}}return{x:d.x,y:d.y}},e.prototype.dragConnectorEnds=function(e,t,i,n,r,o,s){var a,d,l;if(a=t instanceof p?t.annotations[0]:t,i={x:i.x/this.pdfViewer.viewerBase.getZoomFactor(),y:i.y/this.pdfViewer.viewerBase.getZoomFactor()},this.checkBoundaryConstraints(void 0,void 0,a.pageIndex,a.wrapper.bounds)){if("Distance"===a.shapeAnnotationType){var h=b(a,e);if("Leader0"===e)d=i.x-h.point.x,l=i.y-h.point.y,a.vertexPoints[0].x+=d,a.vertexPoints[0].y+=l;else if("Leader1"===e){var c=a.vertexPoints.length-1;d=i.x-h.point.x,l=i.y-h.point.y,a.vertexPoints[c].x+=d,a.vertexPoints[c].y+=l}else{var f=sf.drawings.Point.findAngle(a.sourcePoint,a.targetPoint),g=t.wrapper.children[0].bounds.center,S=sf.drawings.identityMatrix();sf.drawings.rotateMatrix(S,-f,g.x,g.y);var u=sf.drawings.transformPointByMatrix(S,{x:i.x,y:i.y});if("ConnectorSegmentPoint"===e.split("_")[0]){S=sf.drawings.identityMatrix();sf.drawings.rotateMatrix(S,-f,g.x,g.y);var w=sf.drawings.transformPointByMatrix(S,a.vertexPoints[0]),m=sf.drawings.transformPointByMatrix(S,a.vertexPoints[a.vertexPoints.length-1]);if(l=u.y-w.y,0===a.leaderHeight&&null!=a.leaderHeight)a.leaderHeight=this.pdfViewer.distanceSettings.leaderLength;else{a.leaderHeight+=l,w.y+=l,m.y+=l;S=sf.drawings.identityMatrix();sf.drawings.rotateMatrix(S,f,g.x,g.y),a.vertexPoints[0]=sf.drawings.transformPointByMatrix(S,w),a.vertexPoints[a.vertexPoints.length-1]=sf.drawings.transformPointByMatrix(S,m)}}}}else if("ConnectorSegmentPoint"===e.split("_")[0]){var y=Number(e.split("_")[1]);d=i.x-a.vertexPoints[y].x,l=i.y-a.vertexPoints[y].y,a.vertexPoints[y].x+=d,a.vertexPoints[y].y+=l,a.vertexPoints.length>2&&"Perimeter"!==t.measureType&&(0===parseFloat(e.split("_")[1])?(a.vertexPoints[a.vertexPoints.length-1].x+=d,a.vertexPoints[a.vertexPoints.length-1].y+=l):parseFloat(e.split("_")[1])===a.vertexPoints.length-1&&(a.vertexPoints[0].x+=d,a.vertexPoints[0].y+=l))}this.nodePropertyChange(a,{vertexPoints:a.vertexPoints}),this.renderSelector(a.pageIndex,s)}return this.pdfViewer.renderDrawing(),!0},e.prototype.dragSourceEnd=function(e,t,i,n){var r=this.pdfViewer.nameTable[e.id];return r.vertexPoints[n].x+=t,r.vertexPoints[n].y+=i,this.pdfViewer.renderDrawing(),!0},e.prototype.updateConnector=function(e,t){var i;e.vertexPoints=t,z(e,t,e.wrapper.children[0]),e.sourcePoint,i=e.vertexPoints;var n=e.wrapper.children[0];n.canMeasurePath=!0;for(var r=0;r<e.wrapper.children.length;r++)n=e.wrapper.children[r],"Polygon"!==e.shapeAnnotationType&&(n.id.indexOf("srcDec")>-1&&A(e,n,t[0],i[1],!0),e.targetPoint,n.id.indexOf("tarDec")>-1&&A(e,n,t[t.length-1],i[i.length-2],!1))},e.prototype.copy=function(){return this.pdfViewer.clipboardData.pasteIndex=1,this.pdfViewer.clipboardData.clipObject=this.copyObjects(),this.pdfViewer.clipboardData.clipObject},e.prototype.copyObjects=function(){var e=[],t=[];if(this.pdfViewer.clipboardData.childTable={},this.pdfViewer.selectedItems.annotations.length>0){e=this.pdfViewer.selectedItems.annotations;for(var i=0;i<e.length;i++){var n;n=m(e[i]),t.push(n)}}if(0===this.pdfViewer.clipboardData.pasteIndex)for(var r=0,o=e;r<o.length;r++){var s=o[r];this.pdfViewer.nameTable[s.id]&&this.pdfViewer.remove(s)}return this.sortByZIndex(t,"zIndex"),t},e.prototype.getNewObject=function(e){var t,i=[];this.pdfViewer.clipboardData.pasteIndex=1;for(var n=0;n<e.length;n++)t=m(e[n]),i.push(t);return i},e.prototype.paste=function(e,t){if(e||this.pdfViewer.clipboardData.clipObject){var i=e?this.getNewObject(e):this.pdfViewer.clipboardData.clipObject;if(i){i.length;var n={};0!==this.pdfViewer.clipboardData.pasteIndex&&this.pdfViewer.clearSelection(t);for(var r=0,o=i;r<o.length;r++){n[(a=o[r]).id]=a}for(var s=0;s<i.length;s++){var a=i[s],d=this.pdfViewer.viewerBase.getElement("_pageDiv_"+a.pageIndex),l=event;if(f(a))this.calculateCopyPosition(a,d,l);else if(d){var h=d.getBoundingClientRect();a.bounds.x=l.clientX-h.left,a.bounds.y=l.clientY-h.top}var c=m(a);"Cut"!==this.pdfViewer.viewerBase.contextMenuModule.previousAction&&(c.id+=sf.drawings.randomId(),this.pdfViewer.annotationModule&&(c.annotName=c.id,this.pdfViewer.annotationModule.stickyNotesAnnotationModule.updateAnnotationCollection(c,i[0])),this.pdfViewer.annotation.addAction(c.pageIndex,null,c,"Addition","",c,c));var p=this.add(c);("FreeText"===c.shapeAnnotationType||c.enableShapeLabel)&&p&&this.nodePropertyChange(p,{}),this.pdfViewer.select([c.id],this.pdfViewer.annotationSelectorSettings)}}this.pdfViewer.renderDrawing(void 0,t),this.pdfViewer.clipboardData.pasteIndex++}},e.prototype.calculateCopyPosition=function(e,t,i){for(var n,r,o,s,a=0;a<e.vertexPoints.length;a++)if(t)if(0===a){var d=t.getBoundingClientRect();n=e.vertexPoints[a].x,r=e.vertexPoints[a].y,e.vertexPoints[a].x=i.clientX-d.left,e.vertexPoints[a].y=i.clientY-d.top,o=e.vertexPoints[a].x,s=e.vertexPoints[a].y}else e.vertexPoints[a].x+=o-n,e.vertexPoints[a].y+=s-r},e.prototype.cut=function(e){this.pdfViewer.clipboardData.pasteIndex=0,this.pdfViewer.clipboardData.clipObject=this.copyObjects(),this.pdfViewer.renderDrawing(void 0,e)},e.prototype.sortByZIndex=function(e,t){var i=t||"zIndex";return e=e.sort((function(e,t){return e[i]-t[i]}))},e}(),W=(E=function(e,t){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}E(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),X=function(){function e(e,t,i){void 0===i&&(i=!1),this.commandHandler=null,this.inAction=!1,this.pdfViewerBase=null,this.currentElement=null,this.blocked=!1,this.isTooltipVisible=!1,this.childTable={},this.helper=void 0,this.undoElement={annotations:[]},this.undoParentElement={annotations:[]},this.commandHandler=e,this.pdfViewerBase=t}return e.prototype.startAction=function(e){this.currentElement=e,this.inAction=!0},e.prototype.mouseDown=function(e){this.currentElement=e.source,this.startPosition=this.currentPosition=this.prevPosition=e.position,this.isTooltipVisible=!0,this.startAction(e.source)},e.prototype.mouseMove=function(e){return this.currentPosition=e.position,this.prevPageId=this.pdfViewerBase.activeElements.activePageID,!this.blocked},e.prototype.mouseUp=function(e){this.currentPosition=e.position,this.isTooltipVisible=!1,this.endAction(),this.helper=null},e.prototype.endAction=function(){this.commandHandler&&(this.commandHandler.tool="",this.helper&&this.commandHandler.remove(this.helper)),this.commandHandler=null,this.currentElement=null,this.currentPosition=null,this.inAction=!1,this.blocked=!1},e.prototype.mouseWheel=function(e){this.currentPosition=e.position},e.prototype.mouseLeave=function(e){this.mouseUp(e)},e.prototype.updateSize=function(e,t,i,n,r,o,s){e=e;var a,d=this.commandHandler.viewerBase.getZoomFactor(),l=this.currentPosition.x/d-this.startPosition.x/d,h=this.currentPosition.y/d-this.startPosition.y/d,c=e instanceof sf.drawings.TextElement?o:e.rotateAngle;a=sf.drawings.identityMatrix(),sf.drawings.rotateMatrix(a,-c,0,0);var p,f=0,g=0,S=e instanceof sf.drawings.TextElement?e.actualSize.width:e.wrapper.bounds.width,u=e instanceof sf.drawings.TextElement?e.actualSize.height:e.wrapper.bounds.height,w=e;e.annotName||e.shapeAnnotationType||e&&(w=e.annotations[0]);var m=this.commandHandler.annotationModule.findAnnotationSettings(w),y=0,v=0,b=0,x=0;(m.minWidth||m.maxWidth||m.minHeight||m.maxHeight)&&(y=m.maxHeight?m.maxHeight:2e3,v=m.maxWidth?m.maxWidth:2e3,b=m.minHeight?m.minHeight:0,x=m.minWidth?m.minWidth:0);var P=!1;if((b||x||y||v)&&(P=!0),P&&s){var z=this.getPositions(n,l,h),V=S+z.x,A=u+z.y;A>b&&A<y&&V>x&&V<v?(l=l,h=h):((A<b||A>y)&&(h=A<b?b-u:y-u),(V<x||V>v)&&(l=V<x?x-S:v-S))}switch(n){case"ResizeWest":l=(p=sf.drawings.transformPointByMatrix(a,{x:l,y:h})).x,h=p.y,g=1,l=l,h=0,P&&r.width-l>v&&(l=v-r.width),f=(r.width-l)/S;break;case"ResizeEast":l=(p=sf.drawings.transformPointByMatrix(a,{x:l,y:h})).x,h=p.y,h=0,P&&r.width+l>v&&(l=v-r.width),f=(r.width+l)/S,g=1;break;case"ResizeNorth":f=1,l=(p=sf.drawings.transformPointByMatrix(a,{x:l,y:h})).x,h=p.y,P&&r.height-h>y&&(h=y-r.height),g=(r.height-h)/u;break;case"ResizeSouth":f=1,l=(p=sf.drawings.transformPointByMatrix(a,{x:l,y:h})).x,h=p.y,P&&r.height+h>y&&(h=y-r.height),g=(r.height+h)/u;break;case"ResizeNorthEast":l=(p=sf.drawings.transformPointByMatrix(a,{x:l,y:h})).x,h=p.y,P&&(r.width+l>v&&(l=v-r.width),r.height-h>y&&(h=y-r.height)),f=(r.width+l)/S,g=(r.height-h)/u;break;case"ResizeNorthWest":l=(p=sf.drawings.transformPointByMatrix(a,{x:l,y:h})).x,h=p.y,P&&(r.width-l>v&&(l=v-r.width),r.height-h>y&&(h=y-r.height)),f=(r.width-l)/S,g=(r.height-h)/u;break;case"ResizeSouthEast":l=(p=sf.drawings.transformPointByMatrix(a,{x:l,y:h})).x,h=p.y,P&&(r.width+l>v&&(l=v-r.width),r.height+h>y&&(h=y-r.height)),g=(r.height+h)/u,f=(r.width+l)/S;break;case"ResizeSouthWest":l=(p=sf.drawings.transformPointByMatrix(a,{x:l,y:h})).x,h=p.y,P&&(r.width-l>v&&(l=v-r.width),r.height+h>y&&(h=y-r.height)),f=(r.width-l)/S,g=(r.height+h)/u}return{width:f,height:g}},e.prototype.getPivot=function(e){switch(e){case"ResizeWest":return{x:1,y:.5};case"ResizeEast":return{x:0,y:.5};case"ResizeNorth":return{x:.5,y:1};case"ResizeSouth":return{x:.5,y:0};case"ResizeNorthEast":return{x:0,y:1};case"ResizeNorthWest":return{x:1,y:1};case"ResizeSouthEast":return{x:0,y:0};case"ResizeSouthWest":return{x:1,y:0}}return{x:.5,y:.5}},e.prototype.getPositions=function(e,t,i){switch(e){case"ResizeEast":return{x:t,y:0};case"ResizeSouthEast":return{x:t,y:i};case"ResizeSouth":return{x:0,y:i};case"ResizeNorth":return{x:0,y:-i};case"ResizeNorthEast":return{x:t,y:-i};case"ResizeNorthWest":return{x:-t,y:-i};case"ResizeWest":return{x:-t,y:0};case"ResizeSouthWest":return{x:-t,y:i}}return{x:t,y:i}},e}(),Y=function(e){function t(t,i){return e.call(this,t,i,!0)||this}return W(t,e),t.prototype.mouseDown=function(t){this.inAction=!0,this.mouseEventHelper(t),e.prototype.mouseDown.call(this,t)},t.prototype.mouseEventHelper=function(e){this.commandHandler&&this.commandHandler.annotationModule&&(this.commandHandler.annotationModule.overlappedCollections=te(e,this.pdfViewerBase,this.commandHandler,!0));var t,i=te(e,this.pdfViewerBase,this.commandHandler);if(t=e.source&&null!==e.annotationSelectorSettings?e.source.annotationSelectorSettings:"",this.commandHandler){var n=this.commandHandler.selectedItems,r=e.source;(n.annotations.length&&e.info&&!e.info.ctrlKey&&this.commandHandler.annotationModule&&!1===this.commandHandler.annotationModule.freeTextAnnotationModule.isInuptBoxInFocus||e.info&&e.info.ctrlKey&&(r&&"FreeText"===r.shapeAnnotationType||this.commandHandler.selectedItems.annotations[0]&&"FreeText"===this.commandHandler.selectedItems.annotations[0].shapeAnnotationType))&&this.commandHandler.clearSelection(this.pdfViewerBase.activeElements.activePageID),i&&(this.commandHandler.select([i.id],t),this.commandHandler.viewerBase.isAnnotationMouseDown=!0)}},t.prototype.mouseMove=function(t){return e.prototype.mouseMove.call(this,t),!this.blocked},t.prototype.mouseUp=function(t){this.mouseEventHelper(t),this.inAction=!1,e.prototype.mouseUp.call(this,t)},t.prototype.mouseLeave=function(e){this.inAction&&this.mouseUp(e)},t}(X),_=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.currentTarget=null,n.prevNode=null,n}return W(t,e),t.prototype.mouseDown=function(t){e.prototype.mouseDown.call(this,t),this.offset={x:t.source.wrapper.offsetX,y:t.source.wrapper.offsetY},this.startPosition=t.position;var i=m(t.source);this.redoElement={bounds:{x:i.wrapper.offsetX,y:i.wrapper.offsetY,width:i.wrapper.actualSize.width,height:i.wrapper.actualSize.height}},f(i)&&(this.redoElement.vertexPoints=i.vertexPoints,this.redoElement.leaderHeight=i.leaderHeight),this.inAction=!0},t.prototype.mouseUp=function(t){if(this.commandHandler){this.commandHandler.selectedItems&&this.commandHandler.selectedItems.annotations?this.commandHandler.selectedItems.annotations[0].annotName===t.source.annotName&&(this.commandHandler.viewerBase.isAnnotationMouseMove=!0):this.commandHandler.viewerBase.isAnnotationMouseMove=!1;var i=t.source.annotationSelectorSettings;this.commandHandler.clearSelection(this.pdfViewerBase.activeElements.activePageID),this.commandHandler.select([t.source.id],i),this.commandHandler.dragSelectedObjects(this.calculateMouseActionXDiff(t),this.calculateMouseActionYDiff(t),this.pdfViewerBase.activeElements.activePageID,i,null),this.commandHandler.renderSelector(this.pdfViewerBase.activeElements.activePageID,i),this.commandHandler.viewerBase.isAnnotationMouseMove=!1;var n={bounds:{x:t.source.wrapper.offsetX,y:t.source.wrapper.offsetY,width:t.source.wrapper.actualSize.width,height:t.source.wrapper.actualSize.height},modifiedDate:t.source.modifiedDate};f(t.source)&&(n.vertexPoints=t.source.vertexPoints,n.leaderHeight=t.source.leaderHeight),this.commandHandler.annotation.addAction(this.pageIndex,null,t.source,"Drag","",this.redoElement,n),this.commandHandler.annotation.stampAnnotationModule.updateSessionStorage(t.source,null,"Drag"),this.commandHandler.annotation.stickyNotesAnnotationModule.updateStickyNotes(t.source,null)}e.prototype.mouseUp.call(this,t)},t.prototype.calculateMouseXDiff=function(){return this.currentPosition&&this.startPosition?this.currentPosition.x-this.startPosition.x:0},t.prototype.calculateMouseYDiff=function(){return this.currentPosition&&this.startPosition?this.currentPosition.y-this.startPosition.y:0},t.prototype.calculateMouseActionXDiff=function(e){var t=this.calculateMouseXDiff()/this.commandHandler.viewerBase.getZoomFactor();return this.offset?this.offset.x+t-e.source.wrapper.offsetX:0},t.prototype.calculateMouseActionYDiff=function(e){var t=this.calculateMouseYDiff()/this.commandHandler.viewerBase.getZoomFactor();return this.offset?this.offset.y+t-e.source.wrapper.offsetY:0},t.prototype.mouseMove=function(t,i){if(e.prototype.mouseMove.call(this,t),this.inAction){this.currentPosition=t.position,this.currentTarget=t.target;var n=t.source.annotationSelectorSettings,r=this.calculateMouseXDiff()/this.commandHandler.viewerBase.getZoomFactor(),o=this.calculateMouseYDiff()/this.commandHandler.viewerBase.getZoomFactor(),s=this.offset.x+r,a=this.offset.y+o,d=this.calculateMouseActionXDiff(t),l=this.calculateMouseActionYDiff(t);if(this.helper)d=s-this.helper.wrapper.offsetX,l=a-this.helper.wrapper.offsetY;else{this.commandHandler.selectedItems.annotations[0];var h=m(this.commandHandler.selectedItems.annotations[0]);h.wrapper&&(d=s-h.wrapper.offsetX,l=a-h.wrapper.offsetY,h.bounds=this.commandHandler.selectedItems.annotations[0].wrapper.bounds),h.wrapper=void 0,h.id="diagram_helper","Stamp"===h.shapeAnnotationType?(h.strokeColor="",h.borderDashArray="",h.fillColor="transparent",h.stampFillColor="transparent",h.data=""):"FreeText"===h.shapeAnnotationType?(h.strokeColor="blue",h.fillColor="transparent",h.thickness=1,h.opacity=1,h.dynamicText=""):(h.strokeColor="red",h.borderDashArray="5,5",h.fillColor="transparent",h.thickness=2,h.opacity=1),!0===h.enableShapeLabel&&(h.labelContent=""),i?h=this.helper=t.source:this.helper=h=this.commandHandler.add(h),this.commandHandler.selectedItems.annotations=[h]}this.helper&&"Stamp"===this.helper.shapeAnnotationType&&(i=!0),this.commandHandler.checkBoundaryConstraints(d,l,this.pdfViewerBase.activeElements.activePageID,this.helper.wrapper.bounds,i)?(this.commandHandler.dragSelectedObjects(d,l,this.pdfViewerBase.activeElements.activePageID,n,this.helper),this.prevNode=this.helper,this.prevPosition=this.currentPosition):this.currentPosition=this.prevPosition}return!0},t.prototype.mouseLeave=function(t){var i=t.source.annotationSelectorSettings,n=this.offset.x+this.calculateMouseXDiff(),r=this.offset.y+this.calculateMouseYDiff(),o=n-t.source.wrapper.offsetX,s=r-t.source.wrapper.offsetY;this.commandHandler.dragSelectedObjects(o,s,this.prevPageId,i,null),this.commandHandler.renderSelector(this.prevPageId,i),e.prototype.mouseLeave.call(this,t)},t.prototype.endAction=function(){e.prototype.endAction.call(this),this.currentTarget=null,this.prevPosition=null},t}(X),Z=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return W(t,e),t.prototype.mouseDown=function(t){e.prototype.mouseUp.call(this,t)},t.prototype.mouseMove=function(t){var i;if(!this.inAction){var n=this.pdfViewerBase.activeElements.activePageID;this.commandHandler.clearSelection(this.pdfViewerBase.activeElements.activePageID);var r=this.commandHandler.annotation.stampAnnotationModule.moveStampElement(t.position.x,t.position.y,n);i=this.commandHandler.add(r),t.source=this.commandHandler.annotations[this.commandHandler.annotations.length-1],t.sourceWrapper=t.source.wrapper,this.inAction=!0;var o=t.source;o&&"HandWrittenSignature"===o.shapeAnnotationType?this.offset={x:t.source.wrapper.offsetX-t.source.wrapper.bounds.width/2,y:t.source.wrapper.offsetY-t.source.wrapper.bounds.height/2}:this.offset={x:t.source.wrapper.offsetX,y:t.source.wrapper.offsetY},this.startPosition=t.position,this.commandHandler.select([i.id])}var s=t.source.annotationSelectorSettings;return e.prototype.mouseMove.call(this,t,!0),this.commandHandler.renderSelector(t.source.pageIndex,s),this.inAction},t}(_),q=function(e){function t(t,i,n){var r=e.call(this,t,i)||this;return r.sourceObject=n,r}return W(t,e),t.prototype.mouseDown=function(t){e.prototype.mouseDown.call(this,t),this.inAction=!0;var i={currentPosition:this.currentPosition,prevPosition:this.prevPosition};this.commandHandler.annotation.inkAnnotationModule.drawInkInCanvas(i,this.pdfViewerBase.activeElements.activePageID)},t.prototype.mouseMove=function(t){if(e.prototype.mouseMove.call(this,t),this.inAction){var i={currentPosition:this.currentPosition,prevPosition:this.pdfViewerBase.prevPosition};this.commandHandler.annotation.inkAnnotationModule.drawInkInCanvas(i,this.pdfViewerBase.activeElements.activePageID)}return this.inAction},t.prototype.mouseUp=function(t){this.pdfViewerBase.isInkAdded=!0,this.commandHandler.annotation.inkAnnotationModule.mouseX=this.currentPosition.x,this.commandHandler.annotation.inkAnnotationModule.mouseY=this.currentPosition.y;var i=this.commandHandler.annotation.inkAnnotationModule.addInk();return this.commandHandler.renderDrawing(void 0,this.pdfViewerBase.activeElements.activePageID),this.commandHandler.clearSelection(this.pdfViewerBase.activeElements.activePageID),this.commandHandler.select([i.id],i.annotationSelectorSettings),this.pdfViewerBase.isInkAdded=!1,e.prototype.mouseUp.call(this,t),!0},t.prototype.mouseLeave=function(e){this.mouseUp(e)},t.prototype.endAction=function(){e.prototype.endAction.call(this)},t}(X),J=function(e){function t(t,i,n){var r=e.call(this,t,i,!0)||this;return r.endPoint=n,r}return W(t,e),t.prototype.mouseDown=function(t){this.inAction=!0,this.undoElement=void 0,e.prototype.mouseDown.call(this,t),t.source&&t.source.annotations&&({x:this.prevPosition.x,y:this.prevPosition.y},t.source.annotations[0]),this.initialPosition=t.position,this.prevSource=this.commandHandler.selectedItems.annotations[0];var i=m(t.source);this.redoElement={bounds:{x:i.wrapper.offsetX,y:i.wrapper.offsetY,width:i.wrapper.actualSize.width,height:i.wrapper.actualSize.height}},f(i)&&(this.redoElement.vertexPoints=i.vertexPoints,this.redoElement.leaderHeight=i.leaderHeight,"Distance"!==i.measureType&&"Perimeter"!==i.measureType&&"Area"!==i.measureType&&"Volume"!==i.measureType||(this.redoElement.notes=i.notes)),this.currentPosition=t.position},t.prototype.mouseUp=function(t){if(this.commandHandler){var i=this.commandHandler.selectedItems.annotations[0];if(i){var n=this.commandHandler.annotationModule.findAnnotationSettings(i),r=0,o=0,s=0,a=0;if((n.minWidth||n.maxWidth||n.minHeight||n.maxHeight)&&(r=n.maxHeight?n.maxHeight:2e3,o=n.maxWidth?n.maxWidth:2e3,s=n.minHeight?n.minHeight:0,a=n.minWidth?n.minWidth:0),i.vertexPoints.length>3){var d=this.commandHandler.viewerBase.checkAnnotationWidth(i.vertexPoints),l=d.width,h=d.height;s||a||r||o?(h>s&&h<r||l>a&&l<o)&&this.commandHandler.nodePropertyChange(this.prevSource,{vertexPoints:i.vertexPoints,leaderHeight:i.leaderHeight}):this.commandHandler.nodePropertyChange(this.prevSource,{vertexPoints:i.vertexPoints,leaderHeight:i.leaderHeight})}else if(s||a||r||o){i.shapeAnnotationType;var c=0,p=0,g=(c=i.vertexPoints[0].x>i.vertexPoints[1].x?i.vertexPoints[0].x-i.vertexPoints[1].x:i.vertexPoints[1].x-i.vertexPoints[0].x)>(p=i.vertexPoints[0].y>i.vertexPoints[1].y?i.vertexPoints[0].y-i.vertexPoints[1].y:i.vertexPoints[1].y-i.vertexPoints[0].y)?c:p;g<(r||o)&&g>(s||a)&&this.commandHandler.nodePropertyChange(this.prevSource,{vertexPoints:i.vertexPoints,leaderHeight:i.leaderHeight})}else this.commandHandler.nodePropertyChange(this.prevSource,{vertexPoints:i.vertexPoints,leaderHeight:i.leaderHeight});var S=t.source.annotationSelectorSettings;this.commandHandler.clearSelection(this.pdfViewerBase.activeElements.activePageID),this.commandHandler.select([this.prevSource.id],S),this.commandHandler.renderSelector(this.pdfViewerBase.activeElements.activePageID,S);var u={bounds:{x:t.source.wrapper.offsetX,y:t.source.wrapper.offsetY,width:t.source.wrapper.actualSize.width,height:t.source.wrapper.actualSize.height}};"Distance"!==i.measureType&&"Perimeter"!==i.measureType&&"Area"!==i.measureType&&"Volume"!==i.measureType||(this.commandHandler.annotation.updateCalibrateValues(this.commandHandler.selectedItems.annotations[0]),u.notes=t.source.notes),f(t.source)&&(u.vertexPoints=t.source.vertexPoints,u.leaderHeight=t.source.leaderHeight),this.commandHandler.annotation.addAction(this.pageIndex,null,this.prevSource,"Resize","",this.redoElement,u)}}e.prototype.mouseUp.call(this,t)},t.prototype.mouseMove=function(t){if(e.prototype.mouseMove.call(this,t),this.currentPosition=t.position,this.currentPosition&&this.prevPosition){var i=this.currentPosition.x-this.prevPosition.x,n=this.currentPosition.y-this.prevPosition.y;if(t.source&&t.source.annotations&&({x:this.currentPosition.x,y:this.currentPosition.y},{x:this.prevPosition.x,y:this.prevPosition.y},t.source.annotations[0]),this.inAction&&void 0!==this.endPoint&&0!==i||0!==n){if(!this.helper){var r=m(this.commandHandler.selectedItems.annotations[0]);r.id="diagram_helper",r.strokeColor="red",r.borderDashArray="5,5",r.fillColor="transparent",r.thickness=2,r.opacity=1,!0===r.enableShapeLabel&&(r.labelContent=""),this.helper=r=this.commandHandler.add(r),this.commandHandler.selectedItems.annotations=[r]}var o=t.source.annotationSelectorSettings;this.blocked=!this.commandHandler.dragConnectorEnds(this.endPoint,this.helper,this.currentPosition,this.selectedSegment,t.target,null,o),this.commandHandler.renderSelector(this.pdfViewerBase.activeElements.activePageID,o)}}return this.prevPosition=this.currentPosition,!this.blocked},t.prototype.mouseLeave=function(e){this.mouseUp(e)},t.prototype.endAction=function(){e.prototype.endAction.call(this),this.prevPosition=null,this.endPoint=null},t}(X),K=function(e){function t(t,i,n){var r=e.call(this,t,i,!0)||this;return r.initialBounds=new sf.drawings.Rect,r.corner=n,r}return W(t,e),t.prototype.mouseDown=function(t){e.prototype.mouseDown.call(this,t),this.initialBounds.x=t.source.wrapper.offsetX,this.initialBounds.y=t.source.wrapper.offsetY,this.initialBounds.height=t.source.wrapper.actualSize.height,this.initialBounds.width=t.source.wrapper.actualSize.width,this.initialPosition=t.position;var i=m(t.source);this.redoElement={bounds:{x:i.wrapper.offsetX,y:i.wrapper.offsetY,width:i.wrapper.actualSize.width,height:i.wrapper.actualSize.height}},f(i)&&(this.redoElement.vertexPoints=i.vertexPoints,this.redoElement.leaderHeight=i.leaderHeight),"Radius"===i.measureType&&(this.redoElement.notes=i.notes),this.prevSource=this.commandHandler.selectedItems.annotations[0]},t.prototype.mouseUp=function(t,i){if(t.source,this.commandHandler){this.commandHandler.clearSelection(this.pdfViewerBase.activeElements.activePageID),this.commandHandler.viewerBase.isAnnotationSelect=!0,this.commandHandler.select([this.prevSource.id],this.prevSource.annotationSelectorSettings);var n=this.updateSize(this.prevSource,this.currentPosition,this.initialPosition,this.corner,this.initialBounds,null,!0);if(this.blocked=this.scaleObjects(n.width,n.height,this.corner,this.currentPosition,this.initialPosition,this.prevSource),this.commandHandler.selectedItems&&this.commandHandler.selectedItems.annotations&&this.commandHandler.selectedItems.annotations[0]&&"Stamp"===this.commandHandler.selectedItems.annotations[0].shapeAnnotationType&&(this.commandHandler.stampSettings.minHeight||this.commandHandler.stampSettings.minWidth)&&this.commandHandler.select([this.prevSource.id],this.prevSource.annotationSelectorSettings),this.commandHandler.renderSelector(this.prevPageId,this.prevSource.annotationSelectorSettings),this.commandHandler.annotation&&t.source.wrapper){var r={bounds:{x:t.source.wrapper.offsetX,y:t.source.wrapper.offsetY,width:t.source.wrapper.actualSize.width,height:t.source.wrapper.actualSize.height}};f(t.source)&&(r.vertexPoints=t.source.vertexPoints,r.leaderHeight=t.source.leaderHeight),"Radius"===this.prevSource.measureType&&(r.notes=t.source.notes,this.commandHandler.annotation.updateCalibrateValues(this.prevSource)),"FreeText"===this.prevSource.shapeAnnotationType&&this.commandHandler.selectedItems.annotations&&this.commandHandler.selectedItems.annotations.length>0&&this.commandHandler.nodePropertyChange(this.commandHandler.selectedItems.annotations[0],{}),this.commandHandler.annotation.addAction(this.pageIndex,null,this.prevSource,"Resize","",this.redoElement,r)}this.commandHandler.annotation.stampAnnotationModule.updateSessionStorage(t.source,this.prevSource.id,"Resize")}return e.prototype.mouseUp.call(this,t),!this.blocked},t.prototype.mouseMove=function(t){var i;e.prototype.mouseMove.call(this,t),i=t.source,this.currentPosition=t.position;var n=this.currentPosition.x-this.startPosition.x,r=this.currentPosition.y-this.startPosition.y;n/=this.commandHandler.viewerBase.getZoomFactor(),r/=this.commandHandler.viewerBase.getZoomFactor();var o=t.source,s=this.getPoints(n,r),a=o.width+s.x,d=o.height+s.y,l=i;i&&i.annotations&&(l=i.annotations[0]);var h=this.commandHandler.annotationModule.findAnnotationSettings(l),c=0,p=0,f=0,g=0;(h.minWidth||h.maxWidth||h.minHeight||h.maxHeight)&&(c=h.maxHeight?h.maxHeight:2e3,p=h.maxWidth?h.maxWidth:2e3,f=h.minHeight?h.minHeight:0,g=h.minWidth?h.minWidth:0),(f||g||c||p)&&(d>=f&&d<=c&&a>=g&&a<=p?(n=n,r=r):((d<f||d>c)&&(r=d<f?f-o.height:c-o.height),(a<g||a>p)&&(n=a<g?g-o.width:p-o.width)));var S={x:n,y:r};S=sf.drawings.rotatePoint(-this.currentElement.wrapper.rotateAngle,void 0,void 0,S);this.currentElement.wrapper.actualSize.width,S.x,this.currentElement.wrapper.actualSize.width,this.currentElement.wrapper.actualSize.height,S.y,this.currentElement.wrapper.actualSize.height;if(S=this.getChanges(S),!this.helper){var u=m(this.commandHandler.selectedItems.annotations[0]);u.id="diagram_helper","Stamp"===u.shapeAnnotationType?(u.strokeColor="",u.borderDashArray="",u.fillColor="transparent",u.stampFillColor="transparent",u.data=""):"FreeText"===u.shapeAnnotationType?(u.strokeColor="blue",u.fillColor="transparent",u.thickness=1,u.opacity=1,u.dynamicText=""):(u.bounds=this.commandHandler.selectedItems.annotations[0].wrapper.bounds,u.strokeColor="red",u.borderDashArray="5,5",u.fillColor="transparent",u.thickness=2,u.opacity=1),!0===u.enableShapeLabel&&(u.labelContent=""),this.helper=u=this.commandHandler.add(u),this.commandHandler.selectedItems.annotations=[u]}var w=this.updateSize(this.helper,this.startPosition,this.currentPosition,this.corner,this.initialBounds);return this.blocked=!this.scaleObjects(w.width,w.height,this.corner,this.startPosition,this.currentPosition,this.helper),this.prevPosition=this.currentPosition,!this.blocked},t.prototype.mouseLeave=function(e){this.mouseUp(e)},t.prototype.getTooltipContent=function(e){return"W:"+Math.round(e.wrapper.bounds.width)+" H:"+Math.round(e.wrapper.bounds.height)},t.prototype.getChanges=function(e){switch(this.corner){case"ResizeEast":return{x:e.x,y:0};case"ResizeSouthEast":return e;case"ResizeSouth":return{x:0,y:e.y};case"ResizeNorth":return{x:0,y:-e.y};case"ResizeNorthEast":return{x:e.x,y:-e.y};case"ResizeNorthWest":return{x:-e.x,y:-e.y};case"ResizeWest":return{x:-e.x,y:0};case"ResizeSouthWest":return{x:-e.x,y:e.y}}return e},t.prototype.getPoints=function(e,t){switch(this.corner){case"ResizeEast":return{x:e,y:0};case"ResizeSouthEast":return{x:e,y:t};case"ResizeSouth":return{x:0,y:t};case"ResizeNorth":return{x:0,y:-t};case"ResizeNorthEast":return{x:e,y:-t};case"ResizeNorthWest":return{x:-e,y:-t};case"ResizeWest":return{x:-e,y:0};case"ResizeSouthWest":return{x:-e,y:t}}return{x:e,y:t}},t.prototype.scaleObjects=function(e,t,i,n,r,o){if(o instanceof p&&1===o.annotations.length&&("Perimeter"===o.annotations[0].shapeAnnotationType||"Radius"===o.annotations[0].shapeAnnotationType||"Stamp"===o.shapeAnnotationType))t=e=1!==t||1!==e?Math.max(1===t?0:t,1===e?0:e):n!==r?Math.max(t,e):0;else if("Image"===o.shapeAnnotationType||"HandWrittenSignature"===o.shapeAnnotationType)1===t&&1===e||(t=e=Math.max(t,e));else if("Perimeter"===o.shapeAnnotationType||"Radius"===o.shapeAnnotationType||"Stamp"===o.shapeAnnotationType){var s=this.commandHandler.annotationModule.findAnnotationSettings(o),a=0,d=0;(s.maxHeight||s.maxWidth)&&(a=s.maxHeight?s.maxHeight:2e3,d=s.maxWidth?s.maxWidth:2e3),a&&d||1===t&&1===e||(t=e=Math.max(1===t?0:t,1===e?0:e))}o.wrapper.offsetX,o.wrapper.offsetY;return this.blocked=this.commandHandler.scaleSelectedItems(e,t,this.getPivot(this.corner)),this.blocked},t}(X),G=function(e){function t(t,i,n){var r=e.call(this,t,i)||this;return r.sourceObject=n,r}return W(t,e),t.prototype.mouseDown=function(t){e.prototype.mouseDown.call(this,t),this.inAction=!0;var i={bounds:{x:100,y:300,width:100,height:100},pageIndex:0,strokeColor:"red",thickness:3};i.id=sf.drawings.randomId(),this.sourceObject.pageIndex=i.pageIndex=this.pdfViewerBase.activeElements.activePageID||0,this.sourceObject.enableShapeLabel=this.commandHandler.enableShapeLabel,this.pdfViewerBase.updateFreeTextProperties(this.sourceObject),this.commandHandler.drawingObject=this.drawingObject=this.commandHandler.add(this.sourceObject||i)},t.prototype.mouseMove=function(t){if(e.prototype.mouseMove.call(this,t),this.inAction&&!1===sf.drawings.Point.equals(this.currentPosition,this.prevPosition)){this.dragging=!0;var i=sf.drawings.Rect.toBounds([this.prevPosition,this.currentPosition]);this.updateNodeDimension(this.drawingObject,i),"Radius"===this.drawingObject.shapeAnnotationType&&this.updateRadiusLinePosition(this.drawingObject.wrapper.children[1],this.drawingObject)}return!0},t.prototype.mouseUp=function(t){this.drawingObject&&this.dragging&&(this.commandHandler.clearSelection(this.pdfViewerBase.activeElements.activePageID),this.commandHandler.select([this.drawingObject.id],this.commandHandler.annotationSelectorSettings),this.commandHandler.annotation.updateCalibrateValues(this.drawingObject),this.commandHandler&&this.commandHandler.annotation.addAction(this.pageIndex,null,this.drawingObject,"Addition","",this.drawingObject,this.drawingObject),this.drawingObject=null,this.dragging=!1,e.prototype.mouseUp.call(this,t),this.inAction=!1)},t.prototype.endAction=function(){e.prototype.endAction.call(this)},t.prototype.updateNodeDimension=function(e,t){var i=this.commandHandler.viewerBase.getZoomFactor();e.bounds.x=t.x/i+t.width/i,e.bounds.y=t.y/i+t.height/i,e.bounds.width=t.width/i,e.bounds.height=t.height/i;var n=this.commandHandler.annotationModule.findAnnotationSettings(e),r=0,o=0;n.maxWidth||n.maxHeight?(r=n.maxHeight?n.maxHeight:2e3,o=n.maxWidth?n.maxWidth:2e3,e.bounds.width>o&&(e.bounds.width=o),e.bounds.height>r&&(e.bounds.height=r),e.bounds.height<=r&&e.bounds.width<=o&&this.commandHandler.nodePropertyChange(e,{bounds:e.bounds})):this.commandHandler.nodePropertyChange(e,{bounds:e.bounds})},t.prototype.updateRadiusLinePosition=function(e,t){var i={x:t.bounds.x+t.bounds.width/4,y:t.bounds.y},n={x:t.bounds.x+t.bounds.width/2,y:t.bounds.y+t.bounds.height/2},r=sf.drawings.identityMatrix();sf.drawings.rotateMatrix(r,t.rotateAngle,n.x,n.y);var o=sf.drawings.transformPointByMatrix(r,i),s={x:o.x,y:o.y};e.offsetX=s.x,e.offsetY=s.y,e.width=t.bounds.width/2;var a=this.commandHandler.annotationModule.findAnnotationSettings(t),d=0;a.maxWidth&&(d=a.maxWidth?a.maxWidth:2e3,t.bounds.width>d&&(t.bounds.width=d,e.width=t.bounds.width/2)),this.commandHandler.renderDrawing(void 0,t.pageIndex)},t}(X),Q=function(e){function t(t,i,n){var r=e.call(this,t,i)||this;return r.action=n,r}return W(t,e),t.prototype.mouseDown=function(t){if(e.prototype.mouseDown.call(this,t),this.inAction=!0,this.drawingObject){var i=void 0,n=this.drawingObject;i={x:(i=n.vertexPoints[n.vertexPoints.length-1]).x,y:i.y};var r=this.drawingObject.vertexPoints[this.drawingObject.vertexPoints.length-1];r.x===i.x&&r.x===i.y||this.drawingObject.vertexPoints.push(i),this.commandHandler.nodePropertyChange(n,{vertexPoints:n.vertexPoints})}else{this.startPoint={x:this.startPosition.x,y:this.startPosition.y};var o={bounds:{x:this.currentPosition.x,y:this.currentPosition.y,width:5,height:5},vertexPoints:[{x:this.startPoint.x/this.pdfViewerBase.getZoomFactor(),y:this.startPoint.y/this.pdfViewerBase.getZoomFactor()},{x:this.currentPosition.x/this.pdfViewerBase.getZoomFactor(),y:this.currentPosition.y/this.pdfViewerBase.getZoomFactor()}],shapeAnnotationType:"Line",fillColor:this.commandHandler.drawingObject.fillColor,strokeColor:this.commandHandler.drawingObject.strokeColor,pageIndex:this.pdfViewerBase.activeElements.activePageID,notes:this.commandHandler.drawingObject.notes,thickness:this.commandHandler.drawingObject.thickness,author:this.commandHandler.drawingObject.author,subject:this.commandHandler.drawingObject.subject,borderDashArray:this.commandHandler.drawingObject.borderDashArray,modifiedDate:this.commandHandler.drawingObject.modifiedDate,borderStyle:this.commandHandler.drawingObject.borderStyle,measureType:this.commandHandler.drawingObject.measureType,enableShapeLabel:this.commandHandler.enableShapeLabel,opacity:this.commandHandler.drawingObject.opacity};this.pdfViewerBase.updateFreeTextProperties(o),this.drawingObject=this.commandHandler.add(o)}},t.prototype.mouseMove=function(t){if(e.prototype.mouseMove.call(this,t),this.inAction&&!1===sf.drawings.Point.equals(this.currentPosition,this.prevPosition)){this.dragging=!0;var i=this.drawingObject;this.drawingObject&&this.currentPosition&&(i.vertexPoints[i.vertexPoints.length-1].x=this.currentPosition.x/this.pdfViewerBase.getZoomFactor(),i.vertexPoints[i.vertexPoints.length-1].y=this.currentPosition.y/this.pdfViewerBase.getZoomFactor(),this.commandHandler.nodePropertyChange(i,{vertexPoints:i.vertexPoints})),"Perimeter"===i.measureType&&k(i,i.vertexPoints,this.commandHandler.annotation.measureAnnotationModule)}return!0},t.prototype.mouseUp=function(t,i,n){var r;if(e.prototype.mouseMove.call(this,t),t.source&&null!==t.annotationSelectorSettings&&(r=t.source.annotationSelectorSettings),this.drawingObject){var o=new sf.drawings.Rect(this.drawingObject.vertexPoints[this.drawingObject.vertexPoints.length-1].x-20,this.drawingObject.vertexPoints[this.drawingObject.vertexPoints.length-1].y-20,40,40),s={x:this.drawingObject.vertexPoints[0].x,y:this.drawingObject.vertexPoints[0].y};if((o.containsPoint(s)||i)&&this.dragging){if(this.inAction&&(this.inAction=!1,this.drawingObject)){if(n||this.drawingObject.vertexPoints.length>2&&this.drawingObject.vertexPoints.splice(this.drawingObject.vertexPoints.length-1,1),"Polygon"===this.action){n?this.drawingObject.vertexPoints[this.drawingObject.vertexPoints.length]=this.drawingObject.vertexPoints[0]:this.drawingObject.vertexPoints[this.drawingObject.vertexPoints.length-1]=this.drawingObject.vertexPoints[0],this.commandHandler.nodePropertyChange(this.drawingObject,{vertexPoints:this.drawingObject.vertexPoints});var a=m(this.drawingObject);a.shapeAnnotationType="Polygon",a.bounds.width=a.wrapper.actualSize.width,a.bounds.height=a.wrapper.actualSize.height,a.bounds.x=this.drawingObject.wrapper.bounds.x,a.bounds.y=this.drawingObject.wrapper.bounds.y,this.commandHandler.add(a),this.commandHandler.remove(this.drawingObject),this.commandHandler.select([a.id],r);var d=this.commandHandler.selectedItems.annotations[0];d&&(this.commandHandler.enableShapeAnnotation&&(sf.base.isNullOrUndefined(d.measureType)||""===d.measureType)&&this.commandHandler.annotation.shapeAnnotationModule.renderShapeAnnotations(d,d.pageIndex),!this.commandHandler.enableMeasureAnnotation||"Area"!==d.measureType&&"Volume"!==d.measureType||("Area"===d.measureType?(d.notes=this.commandHandler.annotation.measureAnnotationModule.calculateArea(d.vertexPoints),this.commandHandler.annotation.stickyNotesAnnotationModule.addTextToComments(d.annotName,d.notes)):"Volume"===d.measureType&&(d.notes=this.commandHandler.annotation.measureAnnotationModule.calculateVolume(d.vertexPoints),this.commandHandler.annotation.stickyNotesAnnotationModule.addTextToComments(d.annotName,d.notes)),d.enableShapeLabel&&(d.labelContent=d.notes,this.commandHandler.nodePropertyChange(d,{vertexPoints:d.vertexPoints,notes:d.notes})),this.commandHandler.annotation.measureAnnotationModule.renderMeasureShapeAnnotations(d,d.pageIndex)))}else n||i&&this.drawingObject.vertexPoints.splice(this.drawingObject.vertexPoints.length-1,1),this.commandHandler.nodePropertyChange(this.drawingObject,{vertexPoints:this.drawingObject.vertexPoints,sourceDecoraterShapes:this.commandHandler.drawingObject.sourceDecoraterShapes,taregetDecoraterShapes:this.commandHandler.drawingObject.taregetDecoraterShapes}),this.commandHandler.select([this.drawingObject.id],r),this.commandHandler.enableMeasureAnnotation&&"Perimeter"===this.drawingObject.measureType&&(this.commandHandler.renderDrawing(null,this.drawingObject.pageIndex),this.drawingObject.notes=this.commandHandler.annotation.measureAnnotationModule.calculatePerimeter(this.drawingObject),this.drawingObject.enableShapeLabel&&(this.drawingObject.labelContent=this.drawingObject.notes,this.commandHandler.nodePropertyChange(this.drawingObject,{vertexPoints:this.drawingObject.vertexPoints,notes:this.drawingObject.notes})),this.commandHandler.annotation.stickyNotesAnnotationModule.addTextToComments(this.drawingObject.annotName,this.drawingObject.notes),this.commandHandler.annotation.measureAnnotationModule.renderMeasureShapeAnnotations(this.drawingObject,this.drawingObject.pageIndex));var l=this.commandHandler.selectedItems.annotations[0];this.commandHandler.annotation.addAction(this.pageIndex,null,l,"Addition","",l,l),this.drawingObject=null}this.endAction()}else this.inAction&&!this.dragging&&this.commandHandler.remove(this.drawingObject)}},t.prototype.mouseLeave=function(e){this.mouseUp(e,!0,!0)},t.prototype.mouseWheel=function(t){e.prototype.mouseWheel.call(this,t),this.mouseMove(t)},t.prototype.endAction=function(){this.inAction=!1,this.drawingObject=null,this.commandHandler.tool=""},t}(X),$=function(e){function t(t,i,n,r){var o=e.call(this,t,i,!0)||this;return o.endPoint=n,o.drawingObject=r,o}return W(t,e),t.prototype.mouseDown=function(t){if(this.inAction=!0,this.undoElement=void 0,e.prototype.mouseDown.call(this,t),t.source&&t.source.annotations&&({x:this.prevPosition.x,y:this.prevPosition.y},this.drawingObject),this.initialPosition=t.position,this.prevSource=this.drawingObject,this.currentPosition=t.position,this.drawingObject){if(!this.dragging){var i={bounds:{x:this.currentPosition.x,y:this.currentPosition.y,width:5,height:5},vertexPoints:[{x:this.startPosition.x/this.pdfViewerBase.getZoomFactor(),y:this.startPosition.y/this.pdfViewerBase.getZoomFactor()},{x:this.currentPosition.x/this.pdfViewerBase.getZoomFactor(),y:this.currentPosition.y/this.pdfViewerBase.getZoomFactor()}],shapeAnnotationType:this.drawingObject.shapeAnnotationType,sourceDecoraterShapes:this.drawingObject.sourceDecoraterShapes,taregetDecoraterShapes:this.drawingObject.taregetDecoraterShapes,fillColor:this.drawingObject.fillColor,strokeColor:this.drawingObject.strokeColor,pageIndex:this.pdfViewerBase.activeElements.activePageID,opacity:this.drawingObject.opacity||1,borderDashArray:this.drawingObject.borderDashArray,thickness:this.drawingObject.thickness,modifiedDate:this.drawingObject.modifiedDate,author:this.drawingObject.author,subject:this.drawingObject.subject,lineHeadEnd:this.drawingObject.lineHeadEnd,lineHeadStart:this.drawingObject.lineHeadStart,measureType:this.commandHandler.drawingObject.measureType,enableShapeLabel:this.commandHandler.enableShapeLabel};this.pdfViewerBase.updateFreeTextProperties(i),this.drawingObject=this.commandHandler.add(i)}}else{var n=this.commandHandler.annotation.measureAnnotationModule,r={vertexPoints:[{x:this.startPosition.x/this.pdfViewerBase.getZoomFactor(),y:this.startPosition.y/this.pdfViewerBase.getZoomFactor()},{x:this.currentPosition.x/this.pdfViewerBase.getZoomFactor(),y:this.currentPosition.y/this.pdfViewerBase.getZoomFactor()}],bounds:{x:this.currentPosition.x,y:this.currentPosition.y,width:5,height:5},sourceDecoraterShapes:this.commandHandler.drawingObject.sourceDecoraterShapes,taregetDecoraterShapes:this.commandHandler.drawingObject.taregetDecoraterShapes,measureType:"Distance",fillColor:this.commandHandler.drawingObject.fillColor,notes:this.commandHandler.drawingObject.notes,strokeColor:this.commandHandler.drawingObject.strokeColor,opacity:this.commandHandler.drawingObject.opacity,thickness:this.commandHandler.drawingObject.thickness,borderDashArray:this.commandHandler.drawingObject.borderDashArray,shapeAnnotationType:"Distance",pageIndex:this.pdfViewerBase.activeElements.activePageID,author:this.commandHandler.drawingObject.author,subject:this.commandHandler.drawingObject.subject,enableShapeLabel:this.commandHandler.enableShapeLabel,leaderHeight:n.leaderLength};this.pdfViewerBase.updateFreeTextProperties(r),this.drawingObject=this.commandHandler.add(r)}},t.prototype.mouseUp=function(t){if(this.dragging){if(e.prototype.mouseMove.call(this,t),this.commandHandler){var i=void 0;i=t.source&&null!==t.annotationSelectorSettings?t.source.annotationSelectorSettings:"";var n=this.drawingObject;this.commandHandler.nodePropertyChange(n,{vertexPoints:n.vertexPoints,leaderHeight:n.leaderHeight}),this.commandHandler.clearSelection(this.pdfViewerBase.activeElements.activePageID),this.commandHandler.select([n.id],i),this.commandHandler.renderSelector(this.pdfViewerBase.activeElements.activePageID,i)}this.endPoint&&this.endPoint.indexOf("ConnectorSegmentPoint")>-1&&this.dragging&&(this.commandHandler.annotation.updateCalibrateValues(this.drawingObject),this.commandHandler.annotation.addAction(this.pageIndex,null,this.drawingObject,"Addition","",this.drawingObject,this.drawingObject),this.drawingObject=null,this.dragging=!1,e.prototype.mouseUp.call(this,t)),this.drawingObject&&(this.endPoint="ConnectorSegmentPoint_1")}else this.drawingObject&&this.commandHandler.remove(this.drawingObject)},t.prototype.mouseMove=function(t){if(e.prototype.mouseMove.call(this,t),this.inAction&&!1===sf.drawings.Point.equals(this.currentPosition,this.prevPosition)){if(this.currentPosition=t.position,this.dragging=!0,this.currentPosition&&this.prevPosition){var i=this.currentPosition.x-this.prevPosition.x,n=this.currentPosition.y-this.prevPosition.y;this.drawingObject;var r=void 0;r=t.source&&null!==t.annotationSelectorSettings?t.source.annotationSelectorSettings:"",(this.inAction&&this.commandHandler&&this.drawingObject&&void 0!==this.endPoint&&0!==i||0!==n)&&(this.blocked=!this.commandHandler.dragConnectorEnds(this.endPoint,this.drawingObject,this.currentPosition,this.selectedSegment,t.target,null,r),this.commandHandler.renderSelector(this.pdfViewerBase.activeElements.activePageID,r))}this.prevPosition=this.currentPosition}return!this.blocked},t.prototype.mouseLeave=function(e){this.mouseUp(e)},t.prototype.endAction=function(){e.prototype.endAction.call(this),this.prevPosition=null,this.endPoint=null},t}(X),ee=function(e){function t(t,i){return e.call(this,t,i,!0)||this}return W(t,e),t.prototype.mouseDown=function(t){var i=m(t.source);this.undoElement={bounds:{x:i.wrapper.offsetX,y:i.wrapper.offsetY,width:i.wrapper.actualSize.width,height:i.wrapper.actualSize.height},rotateAngle:i.rotateAngle},e.prototype.mouseDown.call(this,t)},t.prototype.mouseUp=function(t){var i,n;if(i=t.source,this.undoElement.rotateAngle!==i.wrapper.rotateAngle){i.wrapper.rotateAngle;m(t.source);var r=t.source.annotations[0].annotationSelectorSettings;this.commandHandler.renderSelector(this.pdfViewerBase.activeElements.activePageID,r),n={bounds:{x:t.source.wrapper.offsetX,y:t.source.wrapper.offsetY,width:t.source.wrapper.actualSize.width,height:t.source.wrapper.actualSize.height},rotateAngle:t.source.wrapper.rotateAngle}}this.commandHandler.annotation.addAction(this.pageIndex,null,t.source,"Rotate","",this.undoElement,n),this.commandHandler.annotation.stampAnnotationModule.updateSessionStorage(t.source,null,"Rotate"),this.commandHandler.annotation.stickyNotesAnnotationModule.updateStickyNotes(t.source,null),e.prototype.mouseUp.call(this,t)},t.prototype.mouseMove=function(t){var i;e.prototype.mouseMove.call(this,t),i=t.source;var n=t.source.annotations[0].annotationSelectorSettings;if(this.currentPosition=t.position,i.wrapper){var r={x:i.wrapper.offsetX,y:i.wrapper.offsetY},o=sf.drawings.Point.findAngle(r,this.currentPosition)+90;o=(o+360)%360;i.wrapper.rotateAngle;this.blocked=!this.commandHandler.rotate(o-i.wrapper.rotateAngle,n)}return!this.blocked},t.prototype.getTooltipContent=function(e){return Math.round(e.rotateAngle%360).toString()+""},t.prototype.mouseLeave=function(e){this.mouseUp(e)},t.prototype.endAction=function(){e.prototype.endAction.call(this)},t}(X);function te(e,t,i,n){if(i&&t.activeElements.activePageID>-1){var r=ie(t,i,e),o=ne(r,e,t,i);return n?r:o}}function ie(e,t,i){var n=e.currentPosition||{x:i.offsetX,y:i.offsetY};return de(n={x:n.x/e.getZoomFactor(),y:n.y/e.getZoomFactor()},t.getPageTable(e.activeElements.activePageID).objects)}function ne(e,t,i,n){var r,o,s,a=null;if(t&&t.type&&-1!==t.type.indexOf("touch")){if(r=t,n.annotation){var d=i.getElement("_pageDiv_"+n.annotation.getEventPageNumber(t));if(d){var l=d.getBoundingClientRect();o=r.changedTouches[0].clientX-l.left,s=r.changedTouches[0].clientY-l.top}}}else o=isNaN(t.offsetX)?t.position?t.position.x:0:t.offsetX,s=isNaN(t.offsetY)?t.position?t.position.y:0:t.offsetY;for(var h=0,c=0;c<e.length;c++)if("Distance"===e[c].shapeAnnotationType||"Line"===e[c].shapeAnnotationType||"LineWidthArrowHead"===e[c].shapeAnnotationType||i.tool instanceof $){var p={x:o/i.getZoomFactor(),y:s/i.getZoomFactor()},f=oe(e[c],p,5),g=F(e[c],p);if(f&&!g){var S=re(e[c],f);if(S){var u=sf.drawings.Rect.toBounds([S,S]);u.Inflate(10),u.containsPoint(p)&&(g=!0)}}f&&g&&(a=e[c])}else{var w=e[c].wrapper.bounds,m=0;if("Stamp"===e[c].shapeAnnotationType&&(m=25),(w.x-5)*i.getZoomFactor()<o&&(w.x+w.width+5)*i.getZoomFactor()>o&&(w.y-5-m)*i.getZoomFactor()<s&&(w.y+w.height+5)*i.getZoomFactor()>s)if(i.tool instanceof G)a=e[c];else if(h){var y=o-(w.x-5)*i.getZoomFactor()+((w.x+w.width+5)*i.getZoomFactor()-o)+(s-(w.y-5-m)*i.getZoomFactor())+((w.y+w.height+5)*i.getZoomFactor()-s);h>y&&(a=e[c],h=y)}else a=e[c],h=o-(w.x-5)*i.getZoomFactor()+((w.x+w.width+5)*i.getZoomFactor()-o)+(s-(w.y-5-m)*i.getZoomFactor())+((w.y+w.height+5)*i.getZoomFactor()-s)}return a}function re(e,t){var i=e.sourcePoint,n=e.targetPoint;if("Distance"===e.shapeAnnotationType){var r=t,o=void 0,s=sf.drawings.Point.findAngle(e.sourcePoint,e.targetPoint);if(r.id.indexOf("leader")>-1){var a=e.wrapper.children[0].bounds.center;r.id.indexOf("leader1")>-1?(o={x:e.sourcePoint.x,y:e.sourcePoint.y-e.leaderHeight},a=i):(o={x:e.targetPoint.x,y:e.targetPoint.y-e.leaderHeight},a=n);var d=sf.drawings.identityMatrix();return sf.drawings.rotateMatrix(d,s,a.x,a.y),sf.drawings.transformPointByMatrix(d,{x:o.x,y:o.y})}}}function oe(e,t,i){return ae(e.wrapper,t,i)}function se(e,t,i){if(0===i.length)i.push(e);else if(1===i.length)i[0][t]>e[t]?i.splice(0,0,e):i.push(e);else if(i.length>1){for(var n=0,r=i.length-1,o=Math.floor((n+r)/2);o!==n;)i[o][t]<e[t]?(n=o,o=Math.floor((n+r)/2)):i[o][t]>e[t]&&(r=o,o=Math.floor((n+r)/2));i[r][t]<e[t]?i.push(e):i[n][t]>e[t]?i.splice(n,0,e):i[n][t]<e[t]&&i[r][t]>e[t]&&i.splice(r,0,e)}}function ae(e,t,i){if(e&&e.children)for(var n=e.children.length-1;n>=0;n--){var r=e.children[n];if(r&&r.bounds.containsPoint(t,10)){if(r instanceof sf.drawings.Container){var o=this.findTargetElement(r,t);if(o)return o}if(r.bounds.containsPoint(t,10))return r}}return e&&e.bounds.containsPoint(t,i)&&"none"!==e.style.fill?e:null}function de(e,t){for(var i=[],n=0,r=t;n<r.length;n++){var o=r[n];(oe(o,e,10)||"Stamp"===o.shapeAnnotationType&&oe(o,e,40))&&se(o,"zIndex",i)}return i}var le=function(){function e(){this.activePage=void 0,this.activePageID=void 0}return Object.defineProperty(e.prototype,"activePageID",{get:function(){return this.activePage},set:function(e){this.activePage=e,this.activePage},enumerable:!0,configurable:!0}),e}();function he(e,t,i){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");return sf.drawings.setAttributeSvg(n,{id:e,width:t,height:i}),n}return e.Drawing=R,e.findActiveElement=te,e.findObjectsUnderMouse=ie,e.findObjectUnderMouse=ne,e.CalculateLeaderPoints=re,e.findElementUnderMouse=oe,e.insertObject=se,e.findTargetShapeElement=ae,e.findObjects=de,e.findActivePage=function(e,t){var i=void 0;if(e.target&&e.target.wrapper)return e.target.pageIndex;if(e.target){var n=e.target.id.split("_");n.length>0&&(i=parseInt(n[n.length-1]))}return i},e.ActiveElements=le,e.renderAdornerLayer=function(e,t,i,n,r){var o=sf.drawings.createHtmlElement("div",{id:r.element.id+n+"_diagramAdornerLayer",style:"width:"+e.width+"px;height:"+e.height+"px;"+t});if(!sf.drawings.getDiagramElement(o.id)){var s=he(r.element.id+n+"_diagramAdorner_svg",e.width,e.height);s.setAttribute("class","e-adorner-layer"+n),s.setAttribute("style","pointer-events:none;"),r.adornerSvgLayer=sf.drawings.createSvgElement("g",{id:r.element.id+"_diagramAdorner"}),r.adornerSvgLayer.setAttribute("style"," pointer-events: all; "),s.appendChild(r.adornerSvgLayer),o.appendChild(s),i.parentElement.appendChild(o);var a=sf.drawings.createSvgElement("g",{id:r.element.id+"_SelectorElement"});r.adornerSvgLayer.appendChild(a),sf.drawings.setAttributeSvg(s,{style:"pointer-events:none;"})}r.viewerBase.applyElementStyles(o,n)},e.createSvg=he,e.ToolBase=X,e.SelectTool=Y,e.MoveTool=_,e.StampTool=Z,e.InkDrawingTool=q,e.ConnectTool=J,e.ResizeTool=K,e.NodeDrawingTool=G,e.PolygonDrawingTool=Q,e.LineTool=$,e.RotateTool=ee,e.PdfBounds=s,e.PdfFont=a,e.PdfAnnotationBase=d,e.ZOrderPageTable=l,e.Selector=p,e.isLineShapes=f,e.setElementStype=g,e.findPointsLength=S,e.findPerimeterLength=function(e){return sf.drawings.Point.getLengthFromListOfPoints(e)},e.getBaseShapeAttributes=u,e.getFunction=w,e.cloneObject=m,e.cloneArray=y,e.getInternalProperties=v,e.isLeader=b,e.getConnectorPoints=x,e.getSegmentPath=P,e.updateSegmentElement=z,e.getSegmentElement=V,e.updateDecoratorElement=A,e.getDecoratorElement=C,e.clipDecorators=O,e.clipDecorator=T,e.initDistanceLabel=H,e.updateDistanceLabel=function(e,t,i){for(var n,r=0;r<e.wrapper.children.length;r++){var o=e.wrapper.children[r];o&&!sf.base.isNullOrUndefined(o.content)&&(n=i.setConversion(S([t[0],t[1]])*i.pixelToPointFactor,e),o.content=n,o.childNodes[0].text=o.content,o.refreshTextElement())}return n},e.updateRadiusLabel=function(e,t){for(var i,n=0;n<e.wrapper.children.length;n++){var r=e.wrapper.children[n];r&&!sf.base.isNullOrUndefined(r.content)&&(i=t.setConversion(e.bounds.width/2*t.pixelToPointFactor,e),r.content=i,2===r.childNodes.length?(r.childNodes[0].text=i,r.childNodes.splice(r.childNodes.length-1,1)):r.childNodes[0].text=i,r.refreshTextElement())}return i},e.initPerimeterLabel=B,e.updatePerimeterLabel=k,e.removePerimeterLabel=function(e){for(var t=0;t<e.wrapper.children.length;t++){var i=e.wrapper.children[t];i&&!sf.base.isNullOrUndefined(i.content)&&e.wrapper.children.splice(t,1)}},e.updateCalibrateLabel=function(e){if(e.wrapper&&e.wrapper.children)for(var t=0;t<e.wrapper.children.length;t++){var i=e.wrapper.children[t];i&&!sf.base.isNullOrUndefined(i.content)&&(i.content=e.notes,i.childNodes[0].text=i.content,i.refreshTextElement())}},e.getPolygonPath=N,e.textElement=D,e.initLeaders=M,e.initLeader=L,e.isPointOverConnector=F,e.findNearestPoint=I,e.getDecoratorShape=j,e}({}))}}]);